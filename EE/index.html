<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Executive Electrical | Test Record</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Babel for JSX compilation in browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- PDF Generation Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; }
        
        /* Custom scrollbar for dark theme */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #111827; }
        ::-webkit-scrollbar-thumb { background: #374151; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #4b5563; }

        /* Print Styles - Engineered for Single Page A4 Landscape */
        @media print {
            @page { 
                size: A4 landscape; 
                margin: 0mm; 
            }
            html, body {
                height: 100%; margin: 0 !important; padding: 0 !important; overflow: hidden !important; 
            }
        }

        /* PDF Generation Container Styles */
        .pdf-container {
            width: 297mm; /* Exact A4 Landscape width */
            height: 210mm; /* Exact A4 Landscape height */
            background: white;
            color: black;
            padding: 10mm;
            box-sizing: border-box;
            font-family: Arial, Helvetica, sans-serif;
            font-size: 9px;
            line-height: 1.1;
            position: relative;
            overflow: hidden;
        }

        /* Helper Classes for the Report */
        .report-table { border-collapse: collapse; width: 100%; table-layout: fixed; }
        .report-table th, .report-table td { 
            border: 1px solid black; 
            padding: 0px 1px; 
            text-align: center; 
            vertical-align: middle; 
            overflow: hidden; 
            white-space: nowrap; 
            height: 13px; /* Tight rows */
            font-size: 7px;
        }
        
        .vertical-text {
            writing-mode: vertical-rl;
            transform: rotate(180deg);
            white-space: nowrap;
            text-align: center;
            margin: 0 auto;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 7px;
            width: 100%;
        }

        .check-box { 
            width: 10px; height: 10px; border: 1px solid black; display: inline-flex; 
            align-items: center; justify-content: center; margin: 0 2px; font-size: 8px; line-height: 1;
        }
        
        .border-b-dotted { border-bottom: 1px dotted black; }
        
        /* Specific Colors from Image */
        .header-black { background-color: black; color: white; }
        .header-blue { background-color: #0ea5e9; color: white; } /* Sky Blueish */
        .header-red { background-color: #dc2626; color: white; }
        .title-red { color: #b91c1c; }
        
        /* Loading Overlay */
        .loader-overlay {
            position: fixed; inset: 0; background: rgba(17, 24, 39, 0.9); z-index: 100;
            display: flex; flex-col; align-items: center; justify-content: center;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo, useRef } from 'https://esm.sh/react@18.2.0';
        import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client';
        import { 
            Zap, Save, Plus, ChevronRight, AlertTriangle, CheckCircle2, 
            FileText, Home, ArrowLeft, Trash2, Activity, ShieldCheck, 
            Download, RotateCcw, Lightbulb, Printer, X, Settings, Calendar,
            Hash, User, PenTool, CheckSquare, MoreHorizontal, Mail, Share2, Loader2
        } from 'https://esm.sh/lucide-react@0.294.0';

        // ==========================================
        // SECTION 1: CONSTANTS & UTILS
        // ==========================================
        
        const CABLE_TYPES = ["PVC", "SWA", "Singles", "FP200", "NYM-J"];
        const CIRCUIT_TYPES = [
            { id: 'socket', label: 'Socket Outlets (Radial)' },
            { id: 'ring', label: 'Socket Outlets (Ring)' },
            { id: 'lighting', label: 'Lighting' },
            { id: 'fixed', label: 'Fixed Appliance' },
            { id: 'ev', label: 'EV Charger' },
            { id: 'cooker', label: 'Cooker / Oven' },
            { id: 'shower', label: 'Shower' }
        ];
        const PROTECTIVE_DEVICES = [
            { id: 'mcb', label: 'MCB' },
            { id: 'rcbo', label: 'RCBO' },
            { id: 'fuse', label: 'Fuse' },
        ];
        const CURVES = ['B', 'C', 'D']; 
        const RATINGS = [6, 10, 16, 20, 25, 32, 40, 50, 63]; 
        const CSA_SIZES = ['1.5', '2.5', '4.0', '6.0', '10.0', '16.0', '25.0'];
        const LOGO_URL = "https://raw.githubusercontent.com/ohmydaysOMD/executiveelectrical.github.io/refs/heads/main/ee.png";

        const getMaxZs = (rating, curve) => {
            const r = parseInt(rating) || 20;
            if (curve === 'B') return (230 / (r * 5)).toFixed(2);
            if (curve === 'C') return (230 / (r * 10)).toFixed(2);
            if (curve === 'D') return (230 / (r * 20)).toFixed(2);
            return (230 / (r * 5)).toFixed(2); 
        };

        // ==========================================
        // SECTION 2: UI COMPONENTS
        // ==========================================

        const Header = ({ view, onBack, title }) => (
            <header className="bg-gray-800 border-b border-gray-700 p-4 sticky top-0 z-50 shadow-lg no-print">
                <div className="flex items-center justify-between max-w-2xl mx-auto">
                    <div className="flex items-center gap-3">
                        {view !== 'dashboard' && (
                            <button onClick={onBack} className="p-2 text-gray-400 hover:text-yellow-400 hover:bg-gray-700 rounded-full transition-colors">
                                <ArrowLeft size={24} />
                            </button>
                        )}
                        <div className="flex items-center gap-3">
                            <div className="w-12 h-12 flex items-center justify-center">
                                <img src={LOGO_URL} alt="EE Logo" className="w-full h-full object-contain" />
                            </div>
                            <div>
                                <h1 className="text-xl font-bold text-yellow-400 tracking-tight leading-none">Executive Electrical</h1>
                                <p className="text-xs text-gray-400 font-medium tracking-wide uppercase mt-0.5">{title}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
        );

        const InputField = ({ label, value, onChange, placeholder, type = "text", icon: Icon, step, min, max }) => (
             <div className="mb-4">
                <label className="block text-sm font-semibold text-gray-400 mb-1 flex items-center gap-2">
                    {Icon && <Icon size={14} className="text-yellow-400" />} {label}
                </label>
                <input
                    type={type}
                    value={value || ''}
                    onChange={(e) => onChange(e.target.value)}
                    className={`block w-full p-3 text-base bg-gray-700 border ${value && max && parseFloat(value) > parseFloat(max) ? 'border-red-500 ring-1 ring-red-500' : 'border-gray-600'} rounded-lg shadow-inner focus:ring-2 focus:ring-yellow-400 text-white transition-all`}
                    placeholder={placeholder}
                    step={step}
                    min={min}
                />
            </div>
        );

        const SelectGroup = ({ label, value, onChange, options, icon: Icon }) => (
            <div className="mb-4">
                <label className="block text-sm font-semibold text-gray-400 mb-1 flex items-center gap-2">
                    {Icon && <Icon size={14} className="text-yellow-400" />} {label}
                </label>
                <div className="relative">
                    <select 
                        value={value} 
                        onChange={(e) => onChange(e.target.value)}
                        className="w-full bg-gray-700 border border-gray-600 text-white text-base rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-transparent block p-3 shadow-inner appearance-none transition-all"
                    >
                        <option value="" disabled>Select {label}</option>
                        {options.map((opt, idx) => (
                            <option key={idx} value={typeof opt === 'object' ? opt.id : opt}>
                                {typeof opt === 'object' ? opt.label : opt}
                            </option>
                        ))}
                    </select>
                    <div className="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none text-gray-400">
                        <ChevronRight size={16} className="rotate-90" />
                    </div>
                </div>
            </div>
        );

        // ==========================================
        // SECTION 3: DASHBOARD
        // ==========================================

        const Dashboard = ({ installation, circuits, stats, setView, createNewCircuit, handleReset, onGenerateReport }) => (
            <div className="pb-24 bg-gray-900 min-h-screen font-sans text-gray-100 no-print">
                <div className="bg-gray-800 p-6 mb-4 border-b border-gray-700 shadow-md">
                    <div className="flex justify-between items-start mb-4">
                        <div>
                            <h2 className="text-2xl font-bold text-white tracking-tight">{installation.clientName || 'New Job'}</h2>
                            <p className="text-sm text-gray-400 mt-1">{installation.address || 'Address not set'}</p>
                        </div>
                        <button onClick={() => setView('details')} className="text-yellow-400 text-sm font-bold border border-yellow-400/30 px-3 py-1 rounded-full hover:bg-yellow-400/10 transition-colors flex items-center gap-1">
                            <PenTool size={12} /> Edit Details
                        </button>
                    </div>
                    <div className="grid grid-cols-3 gap-3 mt-4">
                        <div className="bg-gray-700/50 p-3 rounded-xl border border-gray-600 text-center backdrop-blur-sm"><span className="block text-3xl font-bold text-blue-400">{stats.total}</span><span className="text-[10px] text-gray-400 uppercase font-bold tracking-wider">Circuits</span></div>
                        <div className="bg-gray-700/50 p-3 rounded-xl border border-gray-600 text-center backdrop-blur-sm"><span className="block text-3xl font-bold text-green-400">{stats.completed}</span><span className="text-[10px] text-gray-400 uppercase font-bold tracking-wider">Tested</span></div>
                        <div className={`p-3 rounded-xl border text-center backdrop-blur-sm ${stats.failed > 0 ? 'bg-red-900/20 border-red-500/50' : 'bg-gray-700/50 border-gray-600'}`}><span className={`block text-3xl font-bold ${stats.failed > 0 ? 'text-red-500' : 'text-gray-400'}`}>{stats.failed}</span><span className={`text-[10px] uppercase font-bold tracking-wider ${stats.failed > 0 ? 'text-red-400' : 'text-gray-500'}`}>Failed</span></div>
                    </div>
                    <div className="mt-6 flex gap-3">
                        <button onClick={onGenerateReport} className="flex-1 flex items-center justify-center gap-2 bg-yellow-400 text-gray-900 py-3 rounded-lg text-sm font-bold hover:bg-yellow-300 transition-all shadow-lg shadow-yellow-400/10 transform hover:scale-[1.02] active:scale-[0.98]">
                            <Share2 size={16} /> Export / Send
                        </button>
                        <button onClick={handleReset} className="flex items-center justify-center px-4 bg-gray-700 text-gray-400 rounded-lg hover:bg-red-900/30 hover:text-red-400 border border-gray-600 transition-all"><RotateCcw size={16} /></button>
                    </div>
                </div>

                <div className="px-4">
                    <h3 className="text-xs font-bold text-gray-500 uppercase tracking-widest mb-4 ml-1 flex items-center gap-2"><Activity size={12} /> Circuit Schedule</h3>
                    {circuits.length === 0 ? (
                        <div className="text-center py-16 bg-gray-800/50 rounded-xl border-2 border-dashed border-gray-700 mx-auto max-w-sm">
                            <Zap className="h-12 w-12 text-yellow-400 mx-auto mb-2 animate-pulse opacity-50" />
                            <p className="text-gray-400 font-medium">No circuits yet.</p>
                            <p className="text-gray-500 text-xs mt-1">Tap the + button to add one</p>
                        </div>
                    ) : (
                        <div className="space-y-3">
                            {circuits.map((circuit) => (
                                <CircuitListItem key={circuit.id} circuit={circuit} setView={setView} />
                            ))}
                        </div>
                    )}
                </div>

                <button onClick={createNewCircuit} className="fixed bottom-6 right-6 w-16 h-16 group z-50">
                    {circuits.length === 0 && <span className="absolute inline-flex h-full w-full rounded-full bg-yellow-400 opacity-75 animate-ping"></span>}
                    <span className="relative inline-flex rounded-full h-16 w-16 bg-yellow-400 text-gray-900 shadow-xl shadow-yellow-400/50 items-center justify-center hover:bg-yellow-300 hover:scale-110 active:scale-95 transition-all">
                        <Plus size={32} strokeWidth={2.5} className="group-hover:rotate-90 transition-transform duration-300" />
                    </span>
                </button>
            </div>
        );

        const CircuitListItem = ({ circuit, setView }) => {
            const maxZs = getMaxZs(circuit.rating, circuit.curve);
            const isFailed = circuit.zs && (parseFloat(circuit.zs) > parseFloat(maxZs));
            const isComplete = circuit.zs && circuit.riso_le;
            let statusClass = 'bg-gray-700 text-gray-400';
            if (isFailed) statusClass = 'bg-red-500/20 text-red-400 border border-red-500/50';
            else if (isComplete) statusClass = 'bg-green-500/20 text-green-400 border border-green-500/50';

            return (
                <div onClick={() => { window.setActiveCircuitId(circuit.id); setView('edit-circuit'); }} className={`p-4 rounded-xl border flex items-center justify-between cursor-pointer hover:border-yellow-400/50 transition-colors ${isFailed ? 'bg-red-900/10 border-red-900/50' : 'bg-gray-800 border-gray-700'}`}>
                    <div className="flex items-center gap-4">
                        <div className={`w-12 h-12 rounded-full flex items-center justify-center font-bold text-sm shadow-inner shrink-0 ${statusClass}`}>{circuit.ref}</div>
                        <div>
                            <h4 className="font-bold text-gray-100 text-lg">{circuit.name || 'Untitled Circuit'}</h4>
                            <p className="text-xs text-gray-400 font-mono mt-0.5">{circuit.csa}mm² | {circuit.rating}A Type {circuit.curve}</p>
                            {isFailed && <p className="text-xs text-red-400 font-bold mt-1 flex items-center gap-1"><AlertTriangle size={10} /> FAILED: Zs {circuit.zs}Ω &gt; {maxZs}Ω</p>}
                        </div>
                    </div>
                    <ChevronRight className="text-gray-600" />
                </div>
            );
        };

        // ==========================================
        // SECTION 4: EDITORS
        // ==========================================
        // (Keeping DetailsEditor and CircuitEditor mostly same as previous version but abbreviated here for cleaner file flow)
        
        const DetailsEditor = ({ installation, setInstallation, setView }) => {
            const update = (field, val) => setInstallation(prev => ({...prev, [field]: val}));
            const updateBonding = (key, val) => setInstallation(prev => ({ ...prev, bonding: { ...prev.bonding, [key]: val } }));
            const updateBondingNA = (key, val) => setInstallation(prev => ({ ...prev, bonding_na: { ...prev.bonding_na, [key]: val } }));

            return (
                <div className="p-4 bg-gray-900 min-h-screen text-gray-100 font-sans no-print pb-24">
                    <div className="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700 space-y-6">
                        <h3 className="font-bold text-lg text-yellow-400 border-b border-gray-700 pb-2 mb-4">Job Identifiers</h3>
                        <div className="grid grid-cols-2 gap-4">
                            <InputField label="Record Sheet No" value={installation.recordNo} onChange={v => update('recordNo', v)} placeholder="001" />
                            <InputField label="Seal No" value={installation.sealNo} onChange={v => update('sealNo', v)} placeholder="S-1234" />
                        </div>
                        <div className="grid grid-cols-2 gap-4">
                            <InputField label="Cert No" value={installation.certNo} onChange={v => update('certNo', v)} placeholder="A1234567" />
                            <InputField label="MPRN" value={installation.mprn} onChange={v => update('mprn', v)} placeholder="1001..." />
                        </div>

                        <h3 className="font-bold text-lg text-yellow-400 border-b border-gray-700 pb-2 mb-4">Client & Site</h3>
                        <InputField label="Customer Name" value={installation.clientName} onChange={v => update('clientName', v)} placeholder="Full Name" />
                        <InputField label="Address" value={installation.address} onChange={v => update('address', v)} placeholder="Site Address..." />
                        <div className="mt-4"><InputField label="Dist. Board Ref" value={installation.boardRef} onChange={v => update('boardRef', v)} placeholder="DB-1" /></div>

                        <h3 className="font-bold text-lg text-yellow-400 border-b border-gray-700 pb-2 mb-4">Specs</h3>
                        <SelectGroup label="Category" value={installation.category} onChange={v => update('category', v)} options={['Domestic', 'Commercial', 'Industrial', 'Agricultural']} />
                        <SelectGroup label="Installation Type" value={installation.type || 'New'} onChange={v => update('type', v)} options={['New', 'Rewire', 'Existing', 'Addition', 'Temp Supply', 'Other']} />
                        <InputField label="Comments" value={installation.comments} onChange={v => update('comments', v)} placeholder="Notes..." />

                        <h3 className="font-bold text-lg text-yellow-400 border-b border-gray-700 pb-2 mb-4">Bonding & Earth</h3>
                        <InputField label="Ze (Ext. Loop)" value={installation.ze} onChange={v => update('ze', v)} type="number" step="0.01" />
                        <div className="space-y-2 mb-4">
                             {['Gas', 'Water', 'Supp', 'Electrode', 'Other'].map(type => (
                                <div key={type} className="flex items-center justify-between bg-gray-700 p-3 rounded-lg border border-gray-600">
                                    <span className="text-sm font-bold text-gray-300 w-24">{type}</span>
                                    <div className="flex gap-4">
                                        <label className="flex items-center gap-2"><input type="checkbox" className="w-5 h-5" checked={installation.bonding?.[type]} onChange={e => {updateBonding(type, e.target.checked); if(e.target.checked) updateBondingNA(type, false)}} /><span className="text-xs">YES</span></label>
                                        <label className="flex items-center gap-2"><input type="checkbox" className="w-5 h-5" checked={installation.bonding_na?.[type]} onChange={e => {updateBondingNA(type, e.target.checked); if(e.target.checked) updateBonding(type, false)}} /><span className="text-xs">N/A</span></label>
                                    </div>
                                </div>
                            ))}
                        </div>
                        <div className="grid grid-cols-2 gap-4">
                            <InputField label="Max Rp+Re" value={installation.maxRpRe} onChange={v => update('maxRpRe', v)} placeholder="Ω" />
                            <InputField label="Max Re" value={installation.maxRe} onChange={v => update('maxRe', v)} placeholder="Ω" />
                        </div>

                        <h3 className="font-bold text-lg text-yellow-400 border-b border-gray-700 pb-2 mb-4">Instruments & Sign Off</h3>
                        <div className="grid grid-cols-2 gap-4">
                            <InputField label="Tester Serial" value={installation.testerSerial} onChange={v => update('testerSerial', v)} />
                            <InputField label="Tester Expiry" value={installation.testerExpiry} onChange={v => update('testerExpiry', v)} type="date" />
                        </div>
                        <InputField label="Engineer Name" value={installation.engineerName} onChange={v => update('engineerName', v)} />
                        <div className="grid grid-cols-2 gap-4">
                            <InputField label="QC No" value={installation.qcNo} onChange={v => update('qcNo', v)} />
                            <InputField label="Reg No" value={installation.regNo} onChange={v => update('regNo', v)} />
                        </div>
                        <InputField label="Test Date" value={installation.testDate} onChange={v => update('testDate', v)} type="date" />

                        <button onClick={() => setView('dashboard')} className="w-full bg-yellow-400 text-gray-900 font-bold py-4 rounded-xl mt-4">Save & Return</button>
                    </div>
                </div>
            );
        };

        const CircuitEditor = ({ activeCircuit, setCircuits, setView }) => {
            const [tab, setTab] = useState('wiring');
            const [localCircuit, setLocalCircuit] = useState({...activeCircuit}); 
            const updateField = (field, value) => setLocalCircuit(prev => ({ ...prev, [field]: value }));
            const maxZs = useMemo(() => getMaxZs(localCircuit.rating, localCircuit.curve), [localCircuit.rating, localCircuit.curve]);

            const handleSave = () => {
                setCircuits(prev => prev.map(c => c.id === localCircuit.id ? localCircuit : c));
                setView('dashboard');
            };

            const handleDelete = () => {
                if(window.confirm('Delete this circuit?')) {
                    setCircuits(prev => prev.filter(c => c.id !== localCircuit.id));
                    setView('dashboard');
                }
            };

            return (
                <div className="bg-gray-900 min-h-screen flex flex-col font-sans no-print">
                    <div className="bg-gray-800 px-4 pt-2 border-b border-gray-700 sticky top-0 z-30">
                        <div className="flex -mb-px space-x-8 overflow-x-auto">
                            {['wiring', 'protection', 'testing'].map((t) => (
                                <button key={t} onClick={() => setTab(t)} className={`pb-4 text-sm font-bold capitalize border-b-2 px-1 transition-colors ${tab === t ? 'border-yellow-400 text-yellow-400' : 'border-transparent text-gray-500'}`}>{t}</button>
                            ))}
                        </div>
                    </div>
                    <div className="flex-1 p-5 pb-32 overflow-y-auto">
                        {tab === 'wiring' && (
                            <div className="space-y-5 animate-fadeIn">
                                <div className="grid grid-cols-4 gap-3">
                                    <div className="col-span-1"><InputField label="No." value={localCircuit.ref} onChange={v => updateField('ref', v)} /></div>
                                    <div className="col-span-1"><InputField label="Pts" value={localCircuit.points} onChange={v => updateField('points', v)} type="number" /></div>
                                    <div className="col-span-2"><InputField label="Designation" value={localCircuit.name} onChange={v => updateField('name', v)} /></div>
                                </div>
                                <SelectGroup label="Circuit Type" value={localCircuit.type} onChange={v => updateField('type', v)} options={CIRCUIT_TYPES} />
                                <SelectGroup label="Cable Type" value={localCircuit.cableType} onChange={v => updateField('cableType', v)} options={CABLE_TYPES} />
                                <div className="grid grid-cols-2 gap-4">
                                    <SelectGroup label="CSA" value={localCircuit.csa} onChange={v => updateField('csa', v)} options={CSA_SIZES} />
                                    <InputField label="Comments" value={localCircuit.comments} onChange={v => updateField('comments', v)} />
                                </div>
                            </div>
                        )}
                        {tab === 'protection' && (
                            <div className="space-y-5 animate-fadeIn">
                                <SelectGroup label="Device Type" value={localCircuit.deviceType} onChange={v => updateField('deviceType', v)} options={PROTECTIVE_DEVICES} />
                                <div className="grid grid-cols-2 gap-4">
                                    <SelectGroup label="Rating" value={localCircuit.rating} onChange={v => updateField('rating', v)} options={RATINGS} />
                                    <SelectGroup label="Curve" value={localCircuit.curve} onChange={v => updateField('curve', v)} options={CURVES} />
                                </div>
                            </div>
                        )}
                        {tab === 'testing' && (
                            <div className="space-y-6 animate-fadeIn">
                                <div className="bg-gray-800 p-5 rounded-xl border border-gray-700">
                                    <h4 className="text-sm font-bold text-gray-300 mb-4 border-b border-gray-700 pb-2">Continuity (Ω)</h4>
                                    <div className="grid grid-cols-2 gap-4">
                                        <InputField label="Rp + Re" value={localCircuit.r1r2} onChange={v => updateField('r1r2', v)} type="number" step="0.01" />
                                        <InputField label="Re Only" value={localCircuit.re} onChange={v => updateField('re', v)} type="number" step="0.01" />
                                    </div>
                                    {/* Ring Circuit Fields - ALWAYS visible so user can fill if needed, though mostly for Ring circuits */}
                                    <div className="mt-4 pt-4 border-t border-gray-700">
                                        <p className="text-xs text-blue-400 font-bold mb-2">Ring End-to-End (Optional)</p>
                                        <div className="grid grid-cols-3 gap-2">
                                            <InputField label="L-L" value={localCircuit.ring_ll} onChange={v => updateField('ring_ll', v)} type="number" step="0.01" />
                                            <InputField label="N-N" value={localCircuit.ring_nn} onChange={v => updateField('ring_nn', v)} type="number" step="0.01" />
                                            <InputField label="E-E" value={localCircuit.ring_ee} onChange={v => updateField('ring_ee', v)} type="number" step="0.01" />
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-gray-800 p-5 rounded-xl border border-gray-700">
                                    <h4 className="text-sm font-bold text-gray-300 mb-4 border-b border-gray-700 pb-2">Insulation (MΩ)</h4>
                                    <div className="grid grid-cols-3 gap-2">
                                        <InputField label="Ph/N - E" value={localCircuit.riso_le} onChange={v => updateField('riso_le', v)} />
                                        <InputField label="Ph - N" value={localCircuit.riso_ln} onChange={v => updateField('riso_ln', v)} />
                                        <InputField label="Ph - Ph" value={localCircuit.riso_pp} onChange={v => updateField('riso_pp', v)} />
                                    </div>
                                    <div className="flex items-center justify-between mt-4">
                                         <span className="text-sm text-gray-400 font-bold">Erroneous / Polarity?</span>
                                         <div className="flex gap-2">
                                            <button onClick={() => updateField('erroneousTest', !localCircuit.erroneousTest)} className={`p-2 rounded ${localCircuit.erroneousTest ? 'bg-yellow-500 text-black' : 'bg-gray-600'}`}>Err</button>
                                            <button onClick={() => updateField('polarity', !localCircuit.polarity)} className={`p-2 rounded ${localCircuit.polarity ? 'bg-green-500' : 'bg-gray-600'}`}>Pol</button>
                                         </div>
                                    </div>
                                </div>
                                
                                <div className="bg-gray-800 p-5 rounded-xl border border-gray-700">
                                    <div className="flex justify-between items-center mb-4 border-b border-gray-700 pb-2">
                                        <h4 className="text-sm font-bold text-gray-300">Max Zs: {maxZs}Ω</h4>
                                    </div>
                                    <InputField label="L-E (Ohms)" value={localCircuit.zs} onChange={v => updateField('zs', v)} type="number" step="0.01" max={maxZs} />
                                </div>
                                
                                <div className="bg-gray-800 p-5 rounded-xl border border-gray-700">
                                    <h4 className="text-sm font-bold text-gray-300 mb-4 border-b border-gray-700 pb-2">RCD (ms)</h4>
                                    <div className="grid grid-cols-3 gap-2">
                                        <InputField label="½x" value={localCircuit.rcd_half} onChange={v => updateField('rcd_half', v)} />
                                        <InputField label="1x" value={localCircuit.rcd_x1} onChange={v => updateField('rcd_x1', v)} />
                                        <InputField label="5x" value={localCircuit.rcd_x5} onChange={v => updateField('rcd_x5', v)} />
                                    </div>
                                    <div className="mt-4 flex justify-between items-center">
                                        <span className="text-sm text-gray-400">Button Verified?</span>
                                        <button onClick={() => updateField('rcd_button', !localCircuit.rcd_button)} className={`p-2 rounded ${localCircuit.rcd_button ? 'bg-green-500' : 'bg-gray-600'}`}>Verify</button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                    <div className="fixed bottom-0 left-0 right-0 bg-gray-800 border-t border-gray-700 p-4 max-w-2xl mx-auto flex gap-3 shadow-2xl z-40">
                        <button onClick={handleDelete} className="p-4 text-red-400 bg-red-900/20 rounded-xl"><Trash2 size={24} /></button>
                        <button onClick={handleSave} className="flex-1 bg-yellow-400 text-gray-900 font-bold rounded-xl py-3 flex items-center justify-center gap-2"><Save size={20} /> Save Circuit</button>
                    </div>
                </div>
            );
        };

        // ==========================================
        // SECTION 5: REPORT GENERATOR (Auto-runs)
        // ==========================================

        const ReportGenerator = ({ installation, circuits, onComplete }) => {
            const today = installation.testDate || new Date().toISOString().split('T')[0];
            const maxRows = 16;
            const emptyRows = Math.max(0, maxRows - circuits.length);
            const [status, setStatus] = useState('Preparing...');

            useEffect(() => {
                const generate = async () => {
                    await new Promise(r => setTimeout(r, 800)); // Small delay to allow DOM render
                    setStatus('Capturing Record Sheet...');
                    
                    try {
                        const element = document.getElementById('pdf-target');
                        const canvas = await window.html2canvas(element, { scale: 2, useCORS: true, logging: false });
                        
                        setStatus('Generating PDF...');
                        const imgData = canvas.toDataURL('image/png');
                        const { jsPDF } = window.jspdf;
                        const doc = new jsPDF('l', 'mm', 'a4');
                        doc.addImage(imgData, 'PNG', 0, 0, 297, 210);

                        const blob = doc.output('blob');
                        const uniqueRef = installation.recordNo ? `TestRecord_${installation.recordNo}` : 'TestRecord';
                        const file = new File([blob], `${uniqueRef}.pdf`, { type: 'application/pdf' });

                        setStatus('Ready to Share...');
                        if (navigator.canShare && navigator.canShare({ files: [file] })) {
                            await navigator.share({ files: [file], title: `Test Record ${uniqueRef}` });
                        } else {
                            const url = URL.createObjectURL(blob);
                            const a = document.createElement('a'); a.href = url; a.download = file.name; a.click();
                            URL.revokeObjectURL(url);
                        }
                    } catch (e) {
                        console.error(e);
                        alert("Error generating PDF. Please try again.");
                    }
                    onComplete();
                };
                generate();
            }, []);

            const CheckBox = ({ checked }) => (
                <div className={`check-box ${checked ? 'bg-black text-white' : ''}`}>{checked ? '✓' : ''}</div>
            );

            return (
                <div className="fixed inset-0 bg-white z-50 flex flex-col">
                    {/* LOADING OVERLAY */}
                    <div className="loader-overlay text-white font-bold animate-fadeIn">
                        <Loader2 className="w-12 h-12 mb-4 animate-spin text-yellow-400" />
                        <div className="text-xl">{status}</div>
                        <div className="text-sm text-gray-400 mt-2">Please wait...</div>
                    </div>

                    {/* THE DOCUMENT TO CAPTURE (Hidden behind overlay but rendered) */}
                    <div className="overflow-auto flex items-start justify-center bg-white h-full">
                        <div id="pdf-target" className="pdf-container">
                            
                            {/* TOP HEADER ROW */}
                            <div className="flex items-start justify-between mb-1">
                                <div className="w-32 pt-2">
                                    <div className="flex items-center gap-1 mb-1">
                                        <div className="w-8 h-8"><img src={LOGO_URL} className="w-full h-full object-contain" /></div>
                                        <span className="text-[8px] font-bold">Sheet .... of ....</span>
                                    </div>
                                </div>
                                <div className="text-center pt-2">
                                    <h1 className="text-2xl font-bold title-red tracking-tight" style={{ fontFamily: 'Arial Black, sans-serif' }}>TEST RECORD SHEET</h1>
                                </div>
                                <div className="w-1/3">
                                    <div className="border border-black">
                                        <div className="flex border-b border-black">
                                            <div className="w-32 pl-1 border-r border-black font-bold text-[8px] bg-white">Test Record Sheet No T</div>
                                            <div className="flex-1 pl-1 text-[8px]">{installation.recordNo}</div>
                                            <div className="w-16 pl-1 border-l border-black font-bold text-[8px]">Seal No</div>
                                            <div className="w-20 pl-1 border-l border-black text-[8px]">{installation.sealNo}</div>
                                        </div>
                                        <div className="flex border-b border-black">
                                            <div className="w-24 pl-1 border-r border-black font-bold text-[8px]">MPRN No</div>
                                            <div className="flex-1 text-[8px] flex">
                                                {installation.mprn.split('').map((d,i) => (
                                                    <div key={i} className="flex-1 border-r border-gray-300 text-center last:border-0">{d}</div>
                                                ))}
                                            </div>
                                        </div>
                                        <div className="flex">
                                            <div className="w-24 pl-1 border-r border-black font-bold text-[8px]">Cert No</div>
                                            <div className="flex-1 pl-1 text-[8px]">{installation.certNo}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* CUSTOMER & DETAILS BLOCK */}
                            <div className="mb-1 text-[8px]">
                                <div className="flex items-end mb-1">
                                    <span className="w-24 font-bold uppercase">Customer Name:</span>
                                    <div className="flex-1 border-b-dotted px-2 uppercase">{installation.clientName}</div>
                                </div>
                                <div className="flex items-end mb-1">
                                    <span className="w-24 font-bold uppercase">Installation Address:</span>
                                    <div className="flex-1 border-b-dotted px-2 uppercase">{installation.address}</div>
                                </div>
                                <div className="flex items-end mb-1">
                                    <span className="w-24 font-bold uppercase">Distribution Board Ref:</span>
                                    <div className="w-40 border-b-dotted px-2 uppercase">{installation.boardRef}</div>
                                </div>
                                <div className="flex items-center gap-2 mb-1">
                                    <span className="font-bold w-12 uppercase">Category:</span>
                                    <div className="w-32 border-b-dotted px-1 uppercase">{installation.category}</div>
                                    <span className="text-[7px] italic text-gray-500">(Domestic, Commercial, Industrial etc.)</span>

                                    <span className="font-bold ml-4 uppercase">Type of Installation:</span>
                                    {['New', 'Rewire', 'Existing', 'Addition', 'Temp Supply'].map(type => (
                                        <div key={type} className="flex items-center gap-1">
                                            <span>{type}</span>
                                            <div className="check-box">{installation.type === type ? '✓' : ''}</div>
                                        </div>
                                    ))}
                                    <span className="ml-2">Other (Specify)</span>
                                    <div className="border-b-dotted flex-1"></div>
                                </div>
                                <div className="flex items-end">
                                    <span className="font-bold mr-1">Comments:</span>
                                    <div className="flex-1 border-b-dotted px-2">{installation.comments}</div>
                                    <div className="flex gap-2 ml-2">
                                        <span>MAX Rp+Re (if applicable)</span>
                                        <span className="border-b-dotted w-8 text-center">{installation.maxRpRe}</span>
                                        <span>OHMS</span>
                                        <span className="ml-2">MAX RES.PROT.COND (Re)</span>
                                        <span className="border-b-dotted w-8 text-center">{installation.maxRe}</span>
                                        <span>OHMS</span>
                                    </div>
                                </div>
                            </div>

                            {/* SPLIT SECTION */}
                            <div className="flex gap-1 mb-1 border-t border-black pt-1">
                                <div className="w-[35%] text-[7px] font-bold">
                                    <div className="flex items-center mb-0.5"><span className="w-32 text-right mr-1">MAIN BONDING VERIFIED FOR:</span><span className="w-6">GAS -</span><span>YES</span> <CheckBox checked={installation.bonding?.Gas} /><span className="ml-1">N/A</span> <CheckBox checked={installation.bonding_na?.Gas} /></div>
                                    <div className="flex items-center mb-0.5"><span className="w-32 text-right mr-1"></span><span className="w-6">WATER -</span><span>YES</span> <CheckBox checked={installation.bonding?.Water} /><span className="ml-1">N/A</span> <CheckBox checked={installation.bonding_na?.Water} /></div>
                                    <div className="flex items-center mb-0.5"><span className="w-32 text-right mr-1">SUPPLEMENTARY BONDING VERIFIED -</span><span>YES</span> <CheckBox checked={installation.bonding?.Supp} /><span className="ml-1">N/A</span> <CheckBox checked={installation.bonding_na?.Supp} /></div>
                                    <div className="flex items-center mb-0.5"><span className="w-32 text-right mr-1">ELECTRODE EARTHING CONDUCTOR -</span><span>YES</span> <CheckBox checked={installation.bonding?.Electrode} /><span className="ml-1">N/A</span> <CheckBox checked={installation.bonding_na?.Electrode} /></div>
                                    <div className="flex items-center mb-0.5"><span className="w-32 text-right mr-1">OTHER -</span><span>YES</span><span className="ml-1 font-normal">DETAILS</span><span className="flex-1 border-b-dotted ml-1"></span></div>
                                </div>
                                <div className="flex-1">
                                    <table className="w-full text-[7px] border-black report-table">
                                        <thead>
                                            <tr><th className="bg-gray-200 text-red-800 font-bold uppercase w-1/3">Test Instruments Used</th><th className="bg-gray-200 text-red-800 font-bold uppercase w-1/3">Serial No</th><th className="bg-gray-200 text-red-800 font-bold uppercase w-1/3">Calibration Expiry Date</th></tr>
                                        </thead>
                                        <tbody>
                                            <tr><td className="text-left pl-1">Insulation Resistance/Continuity</td><td>{installation.testerSerial}</td><td>{installation.testerExpiry}</td></tr>
                                            <tr><td className="text-left pl-1">Earth Loop Impedance</td><td>"</td><td>"</td></tr>
                                            <tr><td className="text-left pl-1">RCD</td><td>"</td><td>"</td></tr>
                                            <tr><td className="text-left pl-1">Multifunction</td><td>"</td><td>"</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            {/* MAIN TABLE */}
                            <table className="report-table border-black mb-1">
                                <thead>
                                    {/* HEADERS */}
                                    <tr className="h-4 text-[7px]">
                                        <th colSpan="8" className="header-black text-left pl-2 font-bold uppercase">Circuit Details</th>
                                        <th colSpan="10" className="header-blue font-bold uppercase">Pre Connection</th>
                                        <th colSpan="6" className="header-red font-bold uppercase">Post Connection</th>
                                        <th rowSpan="3" className="w-[18mm] bg-white text-black font-normal text-[5px] text-left p-0.5 leading-tight align-top">
                                            † - MCB / RCBO / Fuse etc.<br/>
                                            †† - Type B-C-D etc.<br/><br/>
                                            * Resistance of phase conductor (Rp)<br/>
                                            ** Resistance of earth conductor (Re)
                                        </th>
                                    </tr>
                                    <tr className="h-6 text-[6px]">
                                        <th rowSpan="2" className="w-[5mm]"><div className="vertical-text">Circuit Number</div></th>
                                        <th rowSpan="2" className="w-auto">Circuit Designation</th>
                                        <th colSpan="2" className="h-3">Cable</th>
                                        <th rowSpan="2" className="w-[5mm]"><div className="vertical-text">No. of Points</div></th>
                                        <th colSpan="3" className="h-3">Overcurrent Protection</th>

                                        <th colSpan="5" className="h-3">Max Circuit Continuity (Ohms)</th>
                                        <th colSpan="3" className="h-3">MIN.INSULATION RES (MEG OHMS)</th>
                                        <th rowSpan="2" className="w-[5mm]"><div className="vertical-text">Erroneous Test Carried out (✓)</div></th>
                                        <th rowSpan="2" className="w-[5mm]"><div className="vertical-text">Polarity Correct (✓)</div></th>

                                        <th rowSpan="2" className="w-[8mm]">L-E<br/>Max Fault<br/>Loop Imp.<br/>(Ohms)</th>
                                        <th colSpan="3" className="h-3">Max RCD Operating times (ms)</th>
                                        <th rowSpan="2" className="w-[5mm]"><div className="vertical-text">RCD Test Button Verified (✓)</div></th>
                                        <th rowSpan="2" className="w-auto">Other Comments</th>
                                    </tr>
                                    <tr className="h-14 text-[6px]">
                                        <th className="w-[6mm] vertical-text">Type</th>
                                        <th className="w-[6mm] vertical-text">Sq mm</th>
                                        <th className="w-[6mm] vertical-text">Device †</th>
                                        <th className="w-[6mm] vertical-text">Type ††</th>
                                        <th className="w-[6mm] vertical-text">Amps</th>
                                        
                                        {/* Pre Conn Sub Headers */}
                                        <th className="w-[8mm]">All Circuits<br/>Rp* + Re**</th>
                                        <th className="w-[6mm]">Re**</th>
                                        <th className="w-[6mm]">L-L</th>
                                        <th className="w-[6mm]">N-N</th>
                                        <th className="w-[6mm]">E-E</th>
                                        
                                        <th className="w-[8mm]">Phase &<br/>Neutral<br/>to Earth<br/>(MΩ)</th>
                                        <th className="w-[8mm]">Phase to<br/>Neutral<br/>(MΩ)</th>
                                        <th className="w-[8mm]">3 Phase<br/>Phase to<br/>Phase<br/>(MΩ)</th>
                                        
                                        <th className="w-[6mm]">½ x<br/>IΔn<br/>(✓)</th>
                                        <th className="w-[6mm]">1 x IΔn</th>
                                        <th className="w-[6mm]">5 x IΔn</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr className="h-3 text-center text-blue-900 font-bold border-black bg-gray-50">
                                        <td>x</td><td className="text-left pl-1">Supply Cable</td>
                                        <td>-</td><td>-</td><td>1</td><td>-</td><td>-</td><td>-</td>
                                        <td>-</td><td>-</td><td>N/A</td><td>N/A</td><td>N/A</td>
                                        <td>-</td><td>-</td><td>-</td><td>-</td><td>-</td>
                                        <td>{installation.ze}</td>
                                        <td>-</td><td>-</td><td>-</td><td>-</td><td>-</td>
                                    </tr>
                                    {circuits.map((c) => (
                                        <tr key={c.id} className="h-3 text-center border-black">
                                            <td>{c.ref}</td>
                                            <td className="text-left pl-1 truncate">{c.name}</td>
                                            <td>{c.cableType}</td><td>{c.csa}</td><td>{c.points}</td>
                                            <td>{c.deviceType}</td><td>{c.curve}</td><td>{c.rating}</td>
                                            <td>{c.r1r2}</td><td>{c.re}</td>
                                            <td>{c.ring_ll}</td><td>{c.ring_nn}</td><td>{c.ring_ee}</td>
                                            <td>{c.riso_le}</td><td>{c.riso_ln}</td><td>{c.riso_pp}</td>
                                            <td>{c.erroneousTest?'✓':''}</td><td>{c.polarity?'✓':''}</td>
                                            <td>{c.zs}</td>
                                            <td>{c.rcd_half}</td><td>{c.rcd_x1}</td><td>{c.rcd_x5}</td>
                                            <td>{c.rcd_button?'✓':''}</td>
                                            <td className="text-left pl-1 truncate">{c.comments}</td>
                                        </tr>
                                    ))}
                                    {[...Array(emptyRows)].map((_, i) => (
                                        <tr key={`empty-${i}`} className="h-3 border-black"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
                                    ))}
                                </tbody>
                            </table>

                            {/* FOOTER */}
                            <div className="absolute bottom-10 left-10mm right-10mm text-[8px]">
                                <div className="flex mb-2">
                                    <span className="w-32">Pre Connection Tested By:</span>
                                    <div className="border-b-dotted flex-1"></div>
                                    <span className="w-16 ml-2">SIGNATURE</span>
                                    <div className="border-b-dotted flex-1 text-blue-900 font-script text-xs">{installation.engineerName}</div>
                                    <span className="w-10 ml-2">QC No.</span><div className="border-b-dotted w-16">{installation.qcNo}</div>
                                    <span className="w-10 ml-2">Reg No.</span><div className="border-b-dotted w-16">{installation.regNo}</div>
                                    <span className="w-8 ml-2">DATE</span><div className="border-b-dotted w-16">{today}</div>
                                </div>
                                <div className="flex">
                                    <span className="w-32">Post Connection Tested By:</span>
                                    <div className="border-b-dotted flex-1"></div>
                                    <span className="w-16 ml-2">SIGNATURE</span>
                                    <div className="border-b-dotted flex-1 text-blue-900 font-script text-xs">{installation.engineerName}</div>
                                    <span className="w-10 ml-2">QC No.</span><div className="border-b-dotted w-16">{installation.qcNo}</div>
                                    <span className="w-10 ml-2">Reg No.</span><div className="border-b-dotted w-16">{installation.regNo}</div>
                                    <span className="w-8 ml-2">DATE</span><div className="border-b-dotted w-16">{today}</div>
                                </div>
                            </div>
                            
                            <div className="absolute bottom-2 w-full text-center text-[6px] text-gray-500">
                                Original To Customer-White &nbsp;&nbsp; Return to Electrical Safety Supervisory Body-Yellow &nbsp;&nbsp; Contractors record-Pink
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // ==========================================
        // SECTION 6: APP
        // ==========================================

        function App() {
            const [view, setView] = useState('dashboard');
            const [activeCircuitId, setActiveCircuitId] = useState(null);
            const [isGeneratingPdf, setIsGeneratingPdf] = useState(false);
            
            // -- PERSISTENCE --
            const [installation, setInstallation] = useState(() => {
                const saved = localStorage.getItem('executive_install');
                return saved ? JSON.parse(saved) : {
                    mprn: '', clientName: '', address: '', ze: '', type: 'New', category: 'Domestic', bonding: {}, bonding_na: {}, 
                    testerSerial: '', testerExpiry: '', recordNo: '', certNo: '', boardRef: '', sealNo: '', comments: '', maxRpRe: '', maxRe: '', engineerName: '', qcNo: '', regNo: '', testDate: ''
                };
            });
            const [circuits, setCircuits] = useState(() => {
                const saved = localStorage.getItem('executive_circuits');
                return saved ? JSON.parse(saved) : [];
            });

            useEffect(() => {
                localStorage.setItem('executive_install', JSON.stringify(installation));
                localStorage.setItem('executive_circuits', JSON.stringify(circuits));
            }, [installation, circuits]);

            useEffect(() => { window.setActiveCircuitId = setActiveCircuitId; }, []);

            const createNewCircuit = () => ({
                id: Date.now(), ref: `${circuits.length + 1}`, name: '', type: 'socket', cableType: 'PVC', csa: '2.5', points: '',
                deviceType: 'rcbo', rating: '20', curve: 'B', r1r2: '', re: '', ring_ll: '', ring_nn: '', ring_ee: '',
                riso_ln: '', riso_le: '', riso_pp: '', zs: '', rcd_x1: '', rcd_x5: '', rcd_half: '', rcd_button: false, polarity: false, erroneousTest: false, comments: ''
            });

            const getStats = () => {
                const total = circuits.length;
                let completed = 0; let failed = 0;
                circuits.forEach(c => {
                    if (c.zs && c.riso_le) completed++;
                    const maxZs = getMaxZs(c.rating, c.curve);
                    if (c.zs && parseFloat(c.zs) > parseFloat(maxZs)) failed++;
                });
                return { total, completed, failed };
            };

            const handleReset = () => {
                if(window.confirm("Delete everything? This cannot be undone.")) {
                    setCircuits([]);
                    setInstallation({ mprn: '', clientName: '', address: '', type: 'New', bonding: {}, bonding_na: {} });
                    localStorage.clear();
                }
            };

            const activeCircuit = circuits.find(c => c.id === activeCircuitId);
            const stats = getStats();

            return (
                <div className="font-sans text-gray-100 max-w-2xl mx-auto bg-gray-900 min-h-screen shadow-2xl border-x border-gray-800">
                    {!isGeneratingPdf && view !== 'report' && <Header view={view} onBack={() => setView('dashboard')} title={view === 'dashboard' ? 'Test Record' : view === 'details' ? 'Edit Details' : 'Circuit Editor'} />}
                    
                    {view === 'dashboard' && !isGeneratingPdf && <Dashboard installation={installation} circuits={circuits} stats={stats} setView={setView} createNewCircuit={() => {
                        const newC = createNewCircuit();
                        setCircuits([...circuits, newC]);
                        setActiveCircuitId(newC.id);
                        setView('edit-circuit');
                    }} handleReset={handleReset} onGenerateReport={() => setIsGeneratingPdf(true)} />}
                    
                    {view === 'edit-circuit' && activeCircuit && !isGeneratingPdf && <CircuitEditor activeCircuit={activeCircuit} setCircuits={setCircuits} setView={setView} />}
                    {view === 'details' && !isGeneratingPdf && <DetailsEditor installation={installation} setInstallation={setInstallation} setView={setView} />}
                    
                    {isGeneratingPdf && (
                        <ReportGenerator 
                            installation={installation} 
                            circuits={circuits} 
                            onComplete={() => setIsGeneratingPdf(false)} 
                        />
                    )}
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
