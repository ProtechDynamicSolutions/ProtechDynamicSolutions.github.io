<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kavanagh Crane Hire - Quote Tool</title>
    <link rel="icon" href="https://kavanaghcranehire.ie/wp-content/uploads/2024/07/quick-quote-chevron-colors-bg.svg" type="image/svg+xml">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.292.0"
        }
    }
    </script>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-yellow': '#fecb00',
                        'brand-black': '#1a1a1a',
                        'kavanagh-blue': '#00CCFF',
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f4f4f5; }
        ::-webkit-scrollbar-thumb { background: #d4d4d8; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #fecb00; }
        
        .white-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(228, 228, 231, 1);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }
        
        select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
        }
        
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            background: #e5e7eb;
            border-radius: 5px;
            outline: none;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #fecb00;
            cursor: pointer;
            transition: background .15s ease-in-out;
        }
        input[type=range]::-webkit-slider-thumb:hover { background: #eab308; }
        body { background-color: #f8fafc; color: #1e293b; }
        
        textarea { resize: vertical; min-height: 80px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, Component } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            FileText, Share, Calendar, MapPin, User, Truck, Phone, 
            Euro, ShieldCheck, Map, HardHat, Clock, Mail, AlertTriangle, 
            FileCheck, Users, Briefcase, TruckIcon, BedDouble, CalendarClock, 
            Settings, Minus, Plus, X, Box, CloudLightning, RefreshCw
        } from 'lucide-react';

        // --- CUSTOM ICONS ---
        const SpreaderBarIcon = ({ size = 16, color = "currentColor", strokeWidth = 2, ...props }) => (
            <svg
                xmlns="http://www.w3.org/2000/svg"
                width={size}
                height={size}
                viewBox="0 0 24 24"
                fill="none"
                stroke={color}
                strokeWidth={strokeWidth}
                strokeLinecap="round"
                strokeLinejoin="round"
                {...props}
            >
                <rect x="2" y="10" width="20" height="4" rx="1" />
                <path d="M12 10V7" />
                <circle cx="12" cy="5" r="2" />
                <path d="M4 14v3c0 1.1.9 2 2 2" />
                <path d="M20 14v3c0 1.1-.9 2-2 2" />
            </svg>
        );

        const ADVISERS_DATA = [
            { name: "Seán O'Herlihy", phone: "083 470 0338", email: "sean.oherlihy@kchcranes.ie" },
            { name: "James Dunne", phone: "087 814 1484", email: "james.dunne@kchcranes.ie" }
        ];

        const getInitials = (name) => {
            const parts = name.split(/[ ']/).filter(Boolean);
            return parts.map(p => p[0]).join('').toUpperCase();
        };

        const ADVISERS = ADVISERS_DATA.map(a => ({
            ...a,
            initials: getInitials(a.name)
        }));

        const CRANE_RATES = {
            40: 75, 50: 90, 60: 95, 80: 110, 90: 120, 100: 135,
            110: 145, 130: 185, 150: 200, 220: 285, 230: 300,
            300: 350, 450: 500, 500: 550
        };

        const getRateForCrane = (craneString) => {
            const match = craneString.match(/\((\d+)t\)/);
            if (!match) return 75; 
            const tons = parseInt(match[1]);
            if (tons <= 40) return 75;
            if (CRANE_RATES[tons]) return CRANE_RATES[tons];
            return 75;
        };

        const CRANE_LIST = [
            {
                category: "Spider & Self-Erecting Cranes",
                cranes: ["Maeda MC285C-3", "Liebherr MK140-5.1", "Spierings SK 1265 (6-Axle)"]
            },
            {
                category: "City & All Terrain Cranes",
                cranes: [
                    "Demag AC30 City (30t)", "Demag AC40-2L (40t)", "Demag AC40 City (40t)",
                    "Liebherr LTM 1040-2.1 (40t)", "Demag AC45 City (45t)", "Liebherr LTF 1045-4.1 (45t)",
                    "Liebherr LTC 1050-3.1 (50t)", "Demag AC50-1 (50t)", "Demag AC55 City (55t)",
                    "Liebherr LTF 1060-4.1 (60t)", "Grove GMK3060 (60t)", "Demag AC60-3L (60t)",
                    "Liebherr LTR 1060 (60t Crawler)", "Liebherr LTM 1060-3.1 (60t)", "Demag AC80-2 (80t)",
                    "Liebherr LTM 1090-4.1 (90t)", "Liebherr LTM 1090-4.2 (90t)", "Tadano ATF 90G-4 (90t)",
                    "Demag AC100-4L (100t)", "Grove GMK4100-4L (100t)", "Liebherr LTM 1100-5.2 (100t)",
                    "Tadano ATF 100G-4 (100t)", "Liebherr LTM 1110-5.1 (110t)", "Demag AC120-1 (120t)",
                    "Grove GMK5130-2 (130t)", "Liebherr LTM 1130-5.1 (130t)", "Liebherr LTM 1150-5.3 (150t)",
                    "Demag AC220-5 (220t)", "Liebherr LTM 1230-5.1 (230t)", "Liebherr LTM 1300-6.2 (300t)",
                    "Liebherr LTM 1300-6.3 (300t)", "Liebherr LTM 1450-8.1 (450t)", "Liebherr LTM 1500-8.1 (500t)",
                    "Liebherr LTM 1650-8.1 (700t)", "Liebherr LTM 1750-9.1 (800t)"
                ]
            }
        ];

        const formatNumber = (num) => {
            return num.toLocaleString('en-IE', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        };

        // --- ERROR BOUNDARY ---
        class ErrorBoundary extends Component {
            constructor(props) { super(props); this.state = { hasError: false, error: null }; }
            static getDerivedStateFromError(error) { return { hasError: true, error }; }
            render() {
                if (this.state.hasError) {
                    return <div className="p-8 text-center"><h2 className="text-red-500 font-bold">Something went wrong</h2><button onClick={() => window.location.reload()} className="mt-4 bg-black text-white px-4 py-2 rounded">Reload</button></div>;
                }
                return this.props.children;
            }
        }

        const InputGroup = ({ label, icon: Icon, children }) => (
            <div className="bg-white p-3.5 rounded-xl border border-slate-200 shadow-sm focus-within:ring-2 focus-within:ring-yellow-400 transition-all group hover:border-slate-300">
                <label className="flex items-center gap-2 text-[10px] font-bold text-slate-400 mb-1.5 uppercase tracking-widest group-focus-within:text-yellow-600 transition-colors">
                    {Icon && <Icon size={12} />} {label}
                </label>
                {children}
            </div>
        );

        const TextInput = ({ ...props }) => (
            <input {...props} className="w-full bg-transparent outline-none text-slate-800 font-semibold placeholder-slate-400 text-sm" />
        );

        const TextArea = ({ rows=3, ...props }) => (
            <textarea rows={rows} {...props} className="w-full bg-transparent outline-none text-slate-800 font-semibold placeholder-slate-400 text-sm p-1 leading-relaxed" />
        );

        const Stepper = ({ label, value, onChange, step = 1, min = 0 }) => {
            const handleDec = () => onChange(Math.max(min, parseFloat(value) - step));
            const handleInc = () => onChange(parseFloat(value) + step);
            return (
                <div className="flex flex-col bg-white rounded-lg border border-slate-200 p-2">
                    <span className="text-[10px] font-bold text-slate-400 uppercase mb-1 block text-center">{label}</span>
                    <div className="flex items-center justify-between gap-2">
                        <button type="button" onClick={handleDec} className="w-8 h-8 rounded-full bg-slate-100 hover:bg-yellow-100 flex items-center justify-center"><Minus size={14}/></button>
                        <span className="font-bold text-slate-900 text-lg w-10 text-center">{value}</span>
                        <button type="button" onClick={handleInc} className="w-8 h-8 rounded-full bg-slate-100 hover:bg-yellow-100 flex items-center justify-center"><Plus size={14}/></button>
                    </div>
                </div>
            );
        };

        function AppContent() {
            const [isGenerating, setIsGenerating] = useState(false);
            const [statusMsg, setStatusMsg] = useState('');
            const [quoteRef, setQuoteRef] = useState('Checking...');
            const [showNotesModal, setShowNotesModal] = useState(false);

            const initialRate = getRateForCrane('Demag AC50-1 (50t)');

            const [formData, setFormData] = useState({
                adviserName: ADVISERS[0].name,
                adviserInitials: ADVISERS[0].initials,
                adviserEmail: ADVISERS[0].email,
                adviserPhone: ADVISERS[0].phone,
                clientName: '',
                clientEmail: '',
                date: new Date().toISOString().split('T')[0],
                craneType: 'Demag AC50-1 (50t)',
                mobHours: 1.0,
                demobHours: 1.0,
                siteHours: 8.0,
                jobDescription: 'Standard crane hire',
                hourlyRate: initialRate,
                overtimeRate: initialRate + 35, 
                addVat: false, 
                siteAddress: 'Cork',
                contactNumber: '',
                liftPlanRequired: false,
                liftPlanCost: 150.00,
                liftPlanIncluded: false,
                spreaderBars: false,
                spreaderCost: 200.00,
                accommodation: true,
                accommodationCost: 150.00,
                weekendCharge: true,
                weekendCost: 35.00,
                apRequired: false,
                apCount: 1,
                apCost: 75.00,
                apIncluded: false,
                banksmanRequired: false,
                banksmanCount: 1,
                banksmanCost: 50.00,
                banksmanIncluded: false,
                ballastRequired: false,
                ballastCost: 600.00,
                otherItemsRequired: false,
                otherItemsDesc: '',
                otherItemsCost: ''
            });

            const totalMinHours = parseFloat(formData.mobHours) + parseFloat(formData.demobHours) + parseFloat(formData.siteHours);
            const travelHours = parseFloat(formData.mobHours) + parseFloat(formData.demobHours);

            const fetchNextQuoteNumber = async (initials) => {
                const now = new Date();
                const yy = now.getFullYear().toString().slice(-2);
                const mm = String(now.getMonth() + 1).padStart(2, '0');
                const dd = String(now.getDate()).padStart(2, '0');
                const hh = String(now.getHours()).padStart(2, '0');
                const min = String(now.getMinutes()).padStart(2, '0');
                
                return `${initials}-${yy}${mm}${dd}${hh}${min}`;
            };

            useEffect(() => {
                let mounted = true;
                const getNum = async () => {
                    const num = await fetchNextQuoteNumber(formData.adviserInitials);
                    if (mounted) setQuoteRef(num);
                };
                getNum();
                return () => { mounted = false; };
            }, [formData.adviserInitials]);


            const handleChange = (e) => {
                const { name, value, type, checked } = e.target;
                setFormData(prev => ({ ...prev, [name]: type === 'checkbox' ? checked : value }));
            };

            const handleCraneChange = (e) => {
                const newCrane = e.target.value;
                const newRate = getRateForCrane(newCrane);
                setFormData(prev => ({
                    ...prev,
                    craneType: newCrane,
                    hourlyRate: newRate,
                    overtimeRate: newRate + 35
                }));
            };

            const handleAdviserChange = (e) => {
                const selected = ADVISERS.find(a => a.name === e.target.value);
                setFormData(prev => ({
                    ...prev,
                    adviserName: selected.name,
                    adviserInitials: selected.initials,
                    adviserEmail: selected.email,
                    adviserPhone: selected.phone
                }));
            };

            const updateHours = (field, newVal) => setFormData(prev => ({ ...prev, [field]: newVal }));

            const getBase64ImageFromURL = (url) => {
                return new Promise((resolve) => {
                    const img = new Image();
                    img.setAttribute("crossOrigin", "anonymous");
                    img.onload = () => {
                        const c = document.createElement("canvas");
                        c.width = img.width; c.height = img.height;
                        resolve(c.getContext("2d").drawImage(img, 0, 0) || c.toDataURL("image/svg"));
                    };
                    img.onerror = () => resolve(null);
                    img.src = url;
                });
            };

            const getColoredBase64FromURL = (url, color) => {
                return new Promise((resolve) => {
                    const img = new Image();
                    img.setAttribute("crossOrigin", "anonymous");
                    img.onload = () => {
                        const c = document.createElement("canvas");
                        c.width = img.width;
                        c.height = img.height;
                        const ctx = c.getContext("2d");
                        ctx.drawImage(img, 0, 0);
                        // Apply tint
                        ctx.globalCompositeOperation = 'source-in';
                        ctx.fillStyle = color;
                        ctx.fillRect(0, 0, c.width, c.height);
                        resolve(c.toDataURL("image/svg"));
                    };
                    img.onerror = () => resolve(null);
                    img.src = url;
                });
            };

            const handleGenerate = async () => {
                if (!window.jspdf) return;
                setIsGenerating(true);

                let uniqueRef = quoteRef;
                if (!uniqueRef || uniqueRef.includes('Loading') || uniqueRef.includes('ERR')) {
                     uniqueRef = await fetchNextQuoteNumber(formData.adviserInitials);
                     setQuoteRef(uniqueRef);
                }

                // Calculate Total
                const hourlyRateVal = parseFloat(formData.hourlyRate || 0);
                
                // Base Calculation: Total Hours * Hourly Rate
                let subTotal = totalMinHours * hourlyRateVal;
                
                // Additional Items
                if (formData.liftPlanRequired && !formData.liftPlanIncluded) subTotal += parseFloat(formData.liftPlanCost);
                if (formData.apRequired && !formData.apIncluded) subTotal += (parseFloat(formData.apCost || 0) * parseInt(formData.apCount));
                if (formData.banksmanRequired && !formData.banksmanIncluded) subTotal += (parseFloat(formData.banksmanCost || 0) * parseInt(formData.banksmanCount));
                if (formData.ballastRequired) subTotal += (parseFloat(formData.ballastCost || 0) * 2);
                if (formData.spreaderBars) subTotal += (parseFloat(formData.spreaderCost || 0) * 2); // Each Way * 2
                if (formData.otherItemsRequired) subTotal += parseFloat(formData.otherItemsCost || 0);
                
                const vatAmount = formData.addVat ? (subTotal * 0.23) : 0;
                const grandTotal = subTotal + vatAmount;

                await generatePDF(uniqueRef, grandTotal, subTotal, vatAmount);
            };

            const generatePDF = async (uniqueRef, grandTotal, subTotal, vatAmount) => {
                setStatusMsg('Generating PDF...');

                try {
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();
                    const yellow = [254, 203, 0]; 
                    const black = [26, 26, 26]; 
                    const darkGrey = [70, 70, 70]; 
                    const mediumGrey = [120, 120, 120];
                    const lightGrey = [248, 248, 248]; 
                    const deepBlue = [30, 50, 70]; // Professional navy accent
                    const goldAccent = [180, 150, 80]; // Muted gold for accents
                    const borderGrey = [180, 180, 180]; // Darkened slightly for table lines
                    const kavanaghYellowHex = '#fecb00';

                    const [headerBg, craneImg, logo50, isoImg, kavLogo, irelandMap] = await Promise.all([
                        getBase64ImageFromURL("https://raw.githubusercontent.com/ProtechDynamicSolutions/ProtechDynamicSolutions.github.io/main/Kavanagh/KavCranes.jpg"),
                        getBase64ImageFromURL("https://raw.githubusercontent.com/ProtechDynamicSolutions/ProtechDynamicSolutions.github.io/main/Kavanagh/ltm-1650-8.1.jpg"),
                        getBase64ImageFromURL("https://raw.githubusercontent.com/ProtechDynamicSolutions/ProtechDynamicSolutions.github.io/main/Kavanagh/Kav50.svg"),
                        getBase64ImageFromURL("https://raw.githubusercontent.com/ProtechDynamicSolutions/ProtechDynamicSolutions.github.io/refs/heads/main/Kavanagh/KavISO.svg"),
                        getBase64ImageFromURL("https://raw.githubusercontent.com/ProtechDynamicSolutions/ProtechDynamicSolutions.github.io/main/Kavanagh/KavLogo.svg"),
                        getColoredBase64FromURL("https://upload.wikimedia.org/wikipedia/commons/8/8e/Blank_Ireland.svg", kavanaghYellowHex)
                    ]);

                    // Elegant footer design
                    const drawFooter = () => {
                        const fY = 268; 
                        
                        // Subtle gradient effect using layered rectangles
                        doc.setFillColor(35, 35, 35);
                        doc.rect(0, fY, 210, 29, 'F');
                        
                        // Gold accent line at top
                        doc.setFillColor(...goldAccent);
                        doc.rect(0, fY, 210, 0.5, 'F');
                        
                        doc.setTextColor(...yellow);
                        doc.setFont("helvetica", "bold"); 
                        doc.setFontSize(9);
                        doc.text("CERTIFICATION & QUALITY ASSURANCE", 20, fY + 7);
                        
                        doc.setTextColor(230, 230, 230); 
                        doc.setFont("helvetica", "normal"); 
                        doc.setFontSize(7.5); 
                        const certText = "We partnered with Amtivo (formerly Certification Europe) for their strong industry reputation and INAB-accreditation. Working with a consultant, we aligned our systems with ISO 9001, ISO 14001, and ISO 45001 standards.";
                        doc.text(doc.splitTextToSize(certText, 110), 20, fY + 13);
                        
                        if (isoImg) {
                            // No background box for logos, just the image
                            doc.addImage(isoImg, 'svg', 135, fY + 6, 55, 18);
                        }
                    };

                    const drawPage1BottomInfo = (startY) => {
                        let leftX = 20;
                        let rightX = 120;
                        let currY = startY;

                        // Elegant divider line above contact section
                        doc.setDrawColor(...borderGrey);
                        doc.setLineWidth(0.3);
                        doc.line(20, currY - 3, 190, currY - 3);

                        // MAP and LOCATIONS (Stacked)
                        if (irelandMap) doc.addImage(irelandMap, 'svg', leftX, currY, 22, 28);
                        
                        const textX = leftX + 28;
                        doc.setTextColor(...deepBlue); 
                        doc.setFont("helvetica", "bold"); 
                        doc.setFontSize(9);
                        doc.text("NATIONWIDE LOCATIONS", textX, currY + 4);
                        
                        doc.setTextColor(...darkGrey); 
                        doc.setFont("helvetica", "normal"); 
                        doc.setFontSize(8.5);
                        const locs = ["Dublin", "Cork", "Wexford", "Waterford", "Carlow"];
                        
                        locs.forEach((loc, i) => {
                            // Small yellow bullet point
                            doc.setFillColor(...yellow);
                            doc.circle(textX, currY + 8.5 + (i*4), 0.8, 'F');
                            doc.setTextColor(...darkGrey);
                            doc.text(loc, textX + 3, currY + 9 + (i*4));
                        });

                        // CONTACT (Right Side) - Refined box
                        doc.setFillColor(252, 252, 252);
                        doc.setDrawColor(...borderGrey);
                        doc.setLineWidth(0.3);
                        doc.roundedRect(rightX - 3, currY - 1, 73, 30, 2, 2, 'FD');
                        
                        doc.setTextColor(...deepBlue); 
                        doc.setFont("helvetica", "bold"); 
                        doc.setFontSize(9);
                        doc.text("YOUR CRANE ADVISER", rightX, currY + 4);
                        
                        doc.setTextColor(...darkGrey); 
                        doc.setFont("helvetica", "normal"); 
                        doc.setFontSize(8.5);
                        let cY = currY + 10;
                        doc.text(formData.adviserName, rightX, cY);
                        cY += 5;
                        doc.setFont("helvetica", "bold");
                        doc.setFontSize(8);
                        doc.text("M:", rightX, cY);
                        doc.setFont("helvetica", "normal");
                        doc.text(formData.adviserPhone, rightX + 6, cY);
                        cY += 5;
                        doc.setFont("helvetica", "bold");
                        doc.text("E:", rightX, cY);
                        doc.setFont("helvetica", "normal");
                        doc.setFontSize(7.5);
                        doc.text(formData.adviserEmail, rightX + 6, cY);
                    };


                    // ====== PAGE 1 ======
                    // Professional header with refined styling
                    if (headerBg) doc.addImage(headerBg, 'JPEG', 0, 0, 210, 55);
                    doc.setGState(new doc.GState({ opacity: 0.88 })); 
                    doc.setFillColor(...yellow); 
                    doc.rect(0, 0, 210, 55, 'F'); 
                    doc.setGState(new doc.GState({ opacity: 1.0 }));
                    
                    // Subtle diagonal accent line
                    doc.setDrawColor(...goldAccent);
                    doc.setLineWidth(1.5);
                    doc.line(0, 55, 210, 55);
                    
                    if (kavLogo) doc.addImage(kavLogo, 'svg', 18, 13, 65, 22); 

                    // Quote reference STYLING (Bold, Shadowed)
                    doc.setFontSize(7); 
                    doc.setFont("helvetica", "normal");
                    doc.setTextColor(...black);
                    doc.text("QUOTE REF", 174, 23, { align: "center" });
                    
                    // Shadow effect for the Quote ID
                    doc.setFontSize(13); // "Nice and big"
                    doc.setFont("helvetica", "bold");
                    doc.setTextColor(0, 204, 255); // Cyan shadow
                    doc.text(uniqueRef, 174 + 0.3, 29 + 0.3, { align: "center" });
                    doc.setTextColor(0, 0, 0); // Black main text
                    doc.text(uniqueRef, 174, 29, { align: "center" });

                    // Refined tagline bar
                    doc.setFillColor(...deepBlue);
                    doc.rect(0, 55, 210, 9, 'F');
                    doc.setTextColor(255, 255, 255); 
                    doc.setFontSize(10); 
                    doc.setFont("times", "italic");
                    doc.text("Elevating Excellence Since 1973 — Where Commitment Meets Capability", 105, 60.5, { align: "center" });
                    doc.setFont("helvetica", "normal");

                    let y = 78; 
                    const mainX = 20; 
                    const fullW = 170; 

                    // INTRO with refined typography
                    doc.setTextColor(...deepBlue); 
                    doc.setFont("helvetica", "bold"); 
                    doc.setFontSize(16);
                    doc.text("PROPOSAL", mainX, y);
                    
                    // Elegant underline
                    doc.setDrawColor(...yellow); 
                    doc.setLineWidth(2); 
                    doc.line(mainX, y+2, mainX+35, y+2);
                    doc.setDrawColor(...goldAccent);
                    doc.setLineWidth(0.5);
                    doc.line(mainX, y+3, mainX+35, y+3);
                    
                    y += 12;

                    // Intro text with better spacing (Updated text)
                    const introWidth = 110;
                    doc.setTextColor(...darkGrey); 
                    doc.setFont("helvetica", "normal"); 
                    doc.setFontSize(9.5); 
                    
                    const newIntroText = "Thank you for giving Kavanagh Crane Hire the opportunity to submit this proposal. Since our formation in 1973 we have gained a wealth of experience and knowledge within the industry. We are committed to maintaining the most modern and advanced equipment there is.\n\nProudly supplying crane hire nationwide, we operate from five strategically located depots in Cork, Dublin, Wexford, Waterford, and Carlow. This network keeps us within close proximity to any job, allowing us to deliver expert crane hire and specialised heavy lift engineering solutions across a range of industries. Backed by years of experience and continuous investment in our state-of-the-art equipment, our local presence ensures fast, efficient, and reliable service for projects of all sizes.";
                    
                    const intro = doc.splitTextToSize(newIntroText, introWidth);
                    doc.text(intro, mainX, y);
                    
                    // Anniversary logo MOVED DOWN approx 3 lines (offset +7 instead of -8)
                    const logoY = y + 2; 
                    if (logo50) {
                        // Subtle shadow effect
                        doc.setGState(new doc.GState({ opacity: 0.15 }));
                        doc.setFillColor(0, 0, 0);
                        doc.circle(172, logoY + 15, 19, 'F');
                        doc.setGState(new doc.GState({ opacity: 1.0 }));
                        doc.addImage(logo50, 'svg', 155, logoY, 35, 28);
                    }
                    
                    // Reduced spacing after intro to pull picture up - DELETE 5 LINES WORTH
                    y += (intro.length * 4.2) + 2; 

                    // Crane image with elegant frame (Rounder corners)
                    if (craneImg) {
                        const imgX = 15;
                        const imgY = y;
                        const imgW = 155;
                        const imgH = 50;
                        
                        // Rounded border frame (Radius increased to 6)
                        doc.setDrawColor(...borderGrey);
                        doc.setLineWidth(0.5);
                        doc.roundedRect(imgX - 1, imgY - 1, imgW + 2.5, imgH + 2.5, 6, 6, 'D');
                        
                        doc.addImage(craneImg, 'JPEG', imgX, imgY, imgW, imgH);
                    }
                    // Reduced spacing after image to prevent footer overlap
                    y += 82; 

                    drawPage1BottomInfo(y);
                    drawFooter();

                    // ====== PAGE 2 ======
                    doc.addPage();
                    
                    // Refined header for page 2
                    doc.setFillColor(...yellow); 
                    doc.rect(0, 0, 210, 24, 'F'); 
                    doc.setDrawColor(...goldAccent);
                    doc.setLineWidth(1.5);
                    doc.line(0, 24, 210, 24);
                    
                    if (kavLogo) doc.addImage(kavLogo, 'svg', 20, 6, 40, 13);
                    
                    // Quote ref badge (No white box, just text with shadow)
                    doc.setTextColor(0, 204, 255); // Cyan shadow
                    doc.setFont("helvetica", "bold"); 
                    doc.setFontSize(12);
                    doc.text(uniqueRef, 179 + 0.3, 14 + 0.3, { align: "center" });
                    doc.setTextColor(0, 0, 0); // Black main
                    doc.text(uniqueRef, 179, 14, { align: "center" });

                    // Margins reduced for Page 2 to fit more content
                    const page2MainX = 15; // Was 20
                    const page2ContentW = 180; // Was 170
                    y = 30; // Moved further down/adjusted

                    // --- JOB SPECIFICATION SECTION ---
                    doc.setTextColor(...deepBlue); 
                    doc.setFont("helvetica", "bold"); 
                    doc.setFontSize(11);
                    doc.text("JOB SPECIFICATION", page2MainX, y);
                    
                    // Elegant underline
                    doc.setDrawColor(...yellow);
                    doc.setLineWidth(1);
                    doc.line(page2MainX, y + 1.5, page2MainX + 45, y + 1.5);
                    
                    y += 6;

                    const drawSpecBox = (label, value, x, y, w, h) => {
                        // Refined box design
                        doc.setFillColor(253, 253, 253);
                        doc.setDrawColor(...borderGrey); 
                        doc.setLineWidth(0.3);
                        doc.roundedRect(x, y, w, h, 1.5, 1.5, 'FD'); 
                        
                        // Label
                        doc.setTextColor(...mediumGrey); 
                        doc.setFontSize(7.5); 
                        doc.setFont("helvetica", "bold");
                        
                        const midY = y + (h/2);
                        
                        if (h > 12) {
                            doc.text(label.toUpperCase(), x + 3, y + 5);
                        } else {
                            doc.text(label.toUpperCase(), x + 3, midY + 0.5);
                        }
                        
                        // Value
                        doc.setTextColor(...black); 
                        doc.setFontSize(9); 
                        doc.setFont("helvetica", "normal");
                        
                        const labelWidth = 28;
                        const valX = x + labelWidth + 2;
                        const valW = w - labelWidth - 3;
                        
                        if (value && value.length > 30) {
                            const splitVal = doc.splitTextToSize(value, valW);
                            const blockH = splitVal.length * 3.5;
                            let startY;
                            if (h > 12) {
                                startY = y + 5; 
                            } else {
                                startY = midY - (blockH/2) + 2; 
                            }
                            doc.text(splitVal, valX, startY);
                        } else {
                             if (h > 12) {
                                doc.text(value || "—", valX, y + 5);
                             } else {
                                doc.text(value || "—", valX, midY + 0.5);
                             }
                        }
                    };

                    // Reduced box height slightly to save space
                    const boxH = 8; 
                    const gap = 2; 
                    const colW = (page2ContentW - gap) / 2;

                    // Row 1
                    drawSpecBox("Customer", formData.clientName, page2MainX, y, colW, boxH);
                    drawSpecBox("Site Address", formData.siteAddress, page2MainX + colW + gap, y, colW, boxH);
                    y += boxH + gap;

                    // Row 2
                    drawSpecBox("Email", formData.clientEmail, page2MainX, y, colW, boxH);
                    drawSpecBox("Phone", formData.contactNumber, page2MainX + colW + gap, y, colW, boxH);
                    y += boxH + gap;
                    
                    // Row 3
                    const descH = 14; 
                    drawSpecBox("Description", formData.jobDescription, page2MainX, y, page2ContentW, descH);
                    y += descH + 2; // Tighter spacing (Was +4)


                    // --- SCHEDULE OF RATES TABLE ---
                    // Professional header design
                    doc.setFillColor(...deepBlue);
                    doc.rect(page2MainX, y, page2ContentW, 7, 'F');
                    
                    // Gold accent line
                    doc.setFillColor(...goldAccent);
                    doc.rect(page2MainX, y, page2ContentW, 1, 'F');
                    
                    doc.setTextColor(255, 255, 255); 
                    doc.setFontSize(9); 
                    doc.setFont("helvetica", "bold");
                    doc.text("SCHEDULE OF RATES / ITEMS", page2MainX + 4, y + 4.5); 
                    doc.text("COST", page2MainX + page2ContentW - 4, y + 4.5, { align: 'right' });
                    y += 6; // Tightened header spacing

                    let rowAlt = false;

                    const drawRow = (label, value, isBold = false) => {
                        let lines = [];
                        let rowH = 6; // Reduced row height for compression
                        
                        if (typeof value === 'string' && (value.length > 50 || value.includes('\n'))) {
                            lines = doc.splitTextToSize(value, 90); 
                            rowH = Math.max(6, (lines.length * 4) + 2); 
                        } else {
                            lines = [value];
                        }

                        if (rowAlt) { 
                            doc.setFillColor(...lightGrey); 
                            doc.rect(page2MainX, y, page2ContentW, rowH, 'F'); 
                        }
                        
                        doc.setTextColor(...black); 
                        doc.setFontSize(9); 
                        doc.setFont("helvetica", isBold ? "bold" : "normal");
                        
                        doc.text(label, page2MainX + 4, y + (rowH/2) + 1.5);
                        
                        doc.setTextColor(...darkGrey);
                        doc.setFont("helvetica", isBold ? "bold" : "normal");
                        
                        lines.forEach((line, i) => {
                             doc.text(line, page2MainX + page2ContentW - 4, y + 4.5 + (i * 4), { align: 'right' });
                        });
                        
                        // DRAW LINE UNDER EACH ITEM
                        doc.setDrawColor(180, 180, 180); // Darker line
                        doc.setLineWidth(0.2);
                        doc.line(page2MainX, y + rowH, page2MainX + page2ContentW, y + rowH);
                        
                        y += rowH;
                        rowAlt = !rowAlt;
                    };

                    drawRow("Crane Type", formData.craneType);
                    
                    const hRateStr = formatNumber(parseFloat(formData.hourlyRate || 0));
                    drawRow("Mobilisation & Demobilisation", `${travelHours} hrs @ EUR ${hRateStr}/hr`);
                    drawRow("Site Duration", `${formData.siteHours} hrs @ EUR ${hRateStr}/hr`);
                    
                    const otRateStr = formatNumber(parseFloat(formData.overtimeRate || 0));
                    // DYNAMIC OVERTIME TEXT
                    const standardSiteHours = Math.max(0, 10 - (parseFloat(formData.mobHours) + parseFloat(formData.demobHours)));
                    drawRow(`Overtime Rate (Applicable after ${standardSiteHours} hrs on site)`, `EUR ${otRateStr}/hr`);
                    
                    if (formData.liftPlanRequired) {
                        drawRow("Lift Plan", formData.liftPlanIncluded ? "Included" : `EUR ${formatNumber(parseFloat(formData.liftPlanCost))}`);
                    }
                    if (formData.apRequired) {
                        drawRow(`Lift Supervisor (x${formData.apCount})`, formData.apIncluded ? "Included" : `EUR ${formatNumber(parseFloat(formData.apCost)*formData.apCount)}`);
                    }
                    if (formData.banksmanRequired) {
                        drawRow(`Banksman (x${formData.banksmanCount})`, formData.banksmanIncluded ? "Included" : `EUR ${formatNumber(parseFloat(formData.banksmanCost)*formData.banksmanCount)}`);
                    }
                    if (formData.ballastRequired) {
                        drawRow("Ballast Truck (x2 trips)", `EUR ${formatNumber(parseFloat(formData.ballastCost || 0) * 2)}`);
                    }
                    if (formData.spreaderBars) {
                        drawRow("Spreader Bars (Delivery & Collection)", `EUR ${formatNumber(parseFloat(formData.spreaderCost || 0) * 2)}`);
                    }
                    if (formData.otherItemsRequired) {
                        const oDesc = formData.otherItemsDesc || "Additional Item";
                        drawRow(oDesc, `EUR ${formatNumber(parseFloat(formData.otherItemsCost))}`);
                    }

                    y += 2; // (Was 3)
                    rowAlt = false;
                    
                    if (formData.addVat) {
                        doc.setFont("helvetica", "bold"); 
                        doc.setTextColor(...black);
                        doc.text("Subtotal (Ex VAT)", page2MainX + 4, y + 5);
                        doc.text(`EUR ${formatNumber(subTotal)}`, page2MainX + page2ContentW - 4, y + 5, { align: 'right' });
                        doc.setDrawColor(...borderGrey); 
                        doc.setLineWidth(0.3);
                        doc.line(page2MainX, y+7, page2MainX+page2ContentW, y+7);
                        y += 8;

                        doc.setFont("helvetica", "normal");
                        doc.text("VAT (23%)", page2MainX + 4, y + 5);
                        doc.text(`EUR ${formatNumber(vatAmount)}`, page2MainX + page2ContentW - 4, y + 5, { align: 'right' });
                        y += 8;
                    }

                    // Refined total box
                    doc.setFillColor(255, 253, 240); 
                    doc.setDrawColor(...goldAccent);
                    doc.setLineWidth(0.8);
                    doc.roundedRect(page2MainX, y, page2ContentW, 11, 2, 2, 'FD');
                    
                    doc.setFont("helvetica", "bold"); 
                    doc.setFontSize(10.5); 
                    doc.setTextColor(...deepBlue);
                    doc.text(formData.addVat ? "TOTAL (Inc VAT)" : "TOTAL MIN. CHARGE (Ex VAT)", page2MainX + 4, y + 7);
                    doc.setTextColor(...black);
                    doc.text(`EUR ${formatNumber(grandTotal)}`, page2MainX + page2ContentW - 4, y + 7, { align: 'right' });
                    
                    y += 22; // INCREASED SPACING to pull next section down (2-line gap approx)
                    
                    // Additional charges section with refined styling
                    doc.setTextColor(...deepBlue); 
                    doc.setFont("helvetica", "bold"); 
                    doc.setFontSize(10);
                    doc.text("ADDITIONAL CHARGES & INSURANCE", page2MainX, y); 
                    
                    doc.setDrawColor(...yellow);
                    doc.setLineWidth(0.8);
                    doc.line(page2MainX, y + 1.5, page2MainX + 68, y + 1.5);
                    
                    y += 5;
                    
                    doc.setTextColor(...darkGrey); 
                    doc.setFont("helvetica", "normal"); 
                    doc.setFontSize(7.5); 
                    
                    const noteLines = [
                        `ADDITIONAL CHARGES: All Saturday, Sunday, and Bank Holiday hours (including travel) are outside normal working hours and charged at an additional EUR ${formatNumber(parseFloat(formData.weekendCost))} per hour. Accommodation, if required, is charged at EUR ${formatNumber(parseFloat(formData.accommodationCost))} per night.`,
                        "INSURANCE HELD: On-Hook: EUR 1m | Height: Unlimited | Employers Liability: EUR 13m | Public Liability: EUR 10m (Primary) & EUR 10m (Excess). Insurance coverage exceeds industry standards."
                    ];

                    noteLines.forEach(line => {
                         const lines = doc.splitTextToSize(line, page2ContentW);
                         doc.text(lines, page2MainX, y);
                         y += (lines.length * 2.5) + 2; 
                    });
                    
                    y += 3; // (Was 4)
                    
                    // Terms section with refined styling
                    doc.setTextColor(...deepBlue); 
                    doc.setFont("helvetica", "bold"); 
                    doc.setFontSize(10);
                    doc.text("TERMS & CONDITIONS", page2MainX, y); 
                    
                    doc.setDrawColor(...yellow);
                    doc.setLineWidth(0.8);
                    doc.line(page2MainX, y + 1.5, page2MainX + 48, y + 1.5);
                    
                    y += 5;
                    
                    const terms = [
                        "1. All site inductions and familiarisation of site by Employing Contractor/ Hirer",
                        "2. Crane standing areas by Employing Contractor/Hirer. Kavanagh Crane Hire cannot accept responsibility for any delays incurred in setting up crane if ground conditions/ access roads are not favourable. Access routes can be assessed by site survey. Kavanagh Crane Hire can arrange a site survey if required",
                        "3. Permits & Traffic management, if required onsite, by Employing Contractor / Hirer. Kavanagh Crane Hire can provide at additional cost, if required. Permit and Traffic management costs are site specific and are determined by relevant local authority charges, traffic implications, etc.",
                        "4. All of the quoted rates are all subject to 23% VAT.",
                        "5. Crane sizes and positions are based on information given. Kavanagh Crane Hire can accept no responsibilities for errors in sizing or positioning cranes. Crane sizes can be determined by site survey. Kavanagh Crane Hire can arrange a site survey if required.",
                        "6. Employing Contractor/ Hirer is responsible for ground conditions under crane and must sign off \"Section 7\" of lift plan confirming that ground has been checked by a competent person and the ground can withstand calculated outrigger loadings. If the employing contractor is unable to sign off on this section, Kavanagh Crane Hire can provide a ground testing service at an additional cost and KCH will sign off \"Section 7\" of lift plan, under \"Contract Lift\" conditions of hire, if we are satisfied with the results of the ground test. A lift plan will be prepared on receipt of P/O or instruction to work",
                        "7. Standard Slings and Chain Slings will be supplied with all cranes. Specialist lifting tackle can be supplied by Kavanagh Crane Hire Ltd. Additional charges may apply",
                        "8. Contract lift hire rates may be subject to additional insurance charges. Insurance costs are determined by value of load lifted. Kavanagh Crane Hire can advise costs on receipt of value of proposed lifts.",
                        "9. Winded off hours will be charged at 75% of the min hire rate"
                    ];
                    
                    doc.setTextColor(...darkGrey); 
                    doc.setFont("helvetica", "normal"); 
                    doc.setFontSize(7); // Reduced font size to fit on page
                    
                    terms.forEach((term, idx) => {
                        const termLines = doc.splitTextToSize(term, page2ContentW);
                        if (y + (termLines.length * 2.5) > 268) {
                            doc.addPage();
                            
                            // Repeat header on new page
                            doc.setFillColor(...yellow); 
                            doc.rect(0, 0, 210, 24, 'F'); 
                            doc.setDrawColor(...goldAccent);
                            doc.setLineWidth(1.5);
                            doc.line(0, 24, 210, 24);
                            
                            if (kavLogo) doc.addImage(kavLogo, 'svg', 20, 6, 40, 13);
                            
                            // Quote ref text on new page (No box)
                            doc.setTextColor(...black); 
                            doc.setFont("helvetica", "bold"); 
                            doc.setFontSize(8.5);
                            doc.text(uniqueRef, 179, 13.5, { align: "center" });
                            
                            y = 35;
                        }
                        
                        doc.setTextColor(...darkGrey);
                        doc.text(termLines, page2MainX, y);
                        y += (termLines.length * 2.5) + 1.5; 
                    });

                    drawFooter();

                    const blob = doc.output('blob');
                    const file = new File([blob], `${uniqueRef}.pdf`, { type: 'application/pdf' });
                    
                    if (navigator.canShare && navigator.canShare({ files: [file] })) {
                        await navigator.share({ files: [file], title: `Quote ${uniqueRef}` });
                        setStatusMsg('Quote Shared');
                    } else {
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a'); a.href = url; a.download = file.name; a.click();
                        setStatusMsg('Quote Downloaded');
                    }

                } catch (err) { console.error(err); setStatusMsg(`Error: ${err.message}`); }
                setTimeout(() => { setIsGenerating(false); setStatusMsg(''); }, 3000);
            };

            return (
                <div className="min-h-screen relative flex flex-col pb-24 bg-slate-50">
                    <nav className="sticky top-0 z-50 bg-brand-yellow shadow-md border-b border-yellow-500">
                        <div className="max-w-3xl mx-auto px-4 py-3 flex justify-between items-center">
                             <div className="flex items-center gap-3">
                                <img src="https://raw.githubusercontent.com/ProtechDynamicSolutions/ProtechDynamicSolutions.github.io/main/Kavanagh/KavLogo.svg" alt="Kavanagh" className="h-10 w-auto object-contain" onError={(e) => e.target.style.display = 'none'} />
                             </div>
                             <div className="px-3 py-1 flex items-center gap-2">
                                <span className="text-xs font-mono font-bold text-slate-800 tracking-wide">
                                    {quoteRef || "---"}
                                </span>
                             </div>
                        </div>
                    </nav>

                    {showNotesModal && (
                        <div className="fixed inset-0 z-[60] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 animate-fade-in">
                            <div className="bg-white w-full max-w-sm rounded-2xl shadow-2xl p-6 relative">
                                <button onClick={() => setShowNotesModal(false)} className="absolute top-4 right-4 text-slate-400 hover:text-slate-600"><X size={20} /></button>
                                <h3 className="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2"><Settings size={18} className="text-yellow-500"/> Configure Standard Notes</h3>
                                <div className="space-y-4">
                                    <div className="flex flex-col gap-2 p-3 bg-slate-50 rounded-lg border border-slate-200">
                                        <div className="flex justify-between items-center"><span className="text-sm font-bold text-slate-700 flex items-center gap-2"><BedDouble size={16}/> Accommodation</span><input type="checkbox" name="accommodation" checked={formData.accommodation} onChange={handleChange} className="w-5 h-5 accent-yellow-500 rounded"/></div>
                                        {formData.accommodation && (<div className="flex items-center gap-2"><span className="text-xs font-bold text-slate-400">€</span><input type="number" name="accommodationCost" value={formData.accommodationCost} onChange={handleChange} className="w-24 text-sm p-1 border rounded" /><span className="text-xs text-slate-400">P/Night</span></div>)}
                                    </div>
                                    <div className="flex flex-col gap-2 p-3 bg-slate-50 rounded-lg border border-slate-200">
                                        <div className="flex justify-between items-center"><span className="text-sm font-bold text-slate-700 flex items-center gap-2"><CalendarClock size={16}/> Weekend Surcharge</span><input type="checkbox" name="weekendCharge" checked={formData.weekendCharge} onChange={handleChange} className="w-5 h-5 accent-yellow-500 rounded"/></div>
                                        {formData.weekendCharge && (<div className="flex items-center gap-2"><span className="text-xs font-bold text-slate-400">€</span><input type="number" name="weekendCost" value={formData.weekendCost} onChange={handleChange} className="w-24 text-sm p-1 border rounded" /><span className="text-xs text-slate-400">/hr</span></div>)}
                                    </div>
                                </div>
                                <button onClick={() => setShowNotesModal(false)} className="w-full mt-6 bg-brand-black text-white font-bold py-3 rounded-xl hover:bg-slate-800 transition-colors">Done</button>
                            </div>
                        </div>
                    )}

                    <main className="flex-grow w-full max-w-3xl mx-auto px-4 py-6 relative z-10 space-y-6">
                        <div className="white-panel p-6 rounded-2xl relative overflow-hidden flex justify-between items-start">
                             <div>
                                 <div className="absolute top-0 right-0 w-32 h-32 bg-yellow-400/10 rounded-full blur-2xl -mr-10 -mt-10 pointer-events-none"></div>
                                 <h2 className="text-xl font-bold text-slate-800 mb-1 flex items-center gap-2"><FileText className="text-brand-yellow" size={24} /> Quote Generator</h2>
                             </div>
                             <button onClick={() => setShowNotesModal(true)} className="bg-slate-100 p-2 rounded-full hover:bg-yellow-100 hover:text-yellow-600 transition-colors z-10"><Settings size={20} /></button>
                        </div>

                        <div className="space-y-4 animate-fade-in grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="md:col-span-2">
                                <InputGroup label="Crane Adviser" icon={HardHat}>
                                    <div className="relative">
                                        <select name="adviser" value={formData.adviserName} onChange={handleAdviserChange} className="w-full bg-transparent outline-none text-slate-900 font-bold appearance-none text-sm cursor-pointer">
                                            {ADVISERS.map(adv => <option key={adv.initials} value={adv.name}>{adv.name}</option>)}
                                        </select>
                                    </div>
                                </InputGroup>
                            </div>

                            <InputGroup label="Date" icon={Calendar}><TextInput type="date" name="date" value={formData.date} onChange={handleChange} /></InputGroup>
                            <InputGroup label="Client Name" icon={User}><TextInput name="clientName" placeholder="Company / Contact" value={formData.clientName} onChange={handleChange} /></InputGroup>
                            <InputGroup label="Client Email" icon={Mail}><TextInput type="email" name="clientEmail" placeholder="client@email.com" value={formData.clientEmail} onChange={handleChange} /></InputGroup>
                            <InputGroup label="Client Phone" icon={Phone}><TextInput type="tel" name="contactNumber" placeholder="08X..." value={formData.contactNumber} onChange={handleChange} /></InputGroup>
                            <div className="md:col-span-2"><InputGroup label="Site Address" icon={MapPin}><TextInput name="siteAddress" value={formData.siteAddress} onChange={handleChange} /></InputGroup></div>

                            <div className="md:col-span-2">
                                <InputGroup label="Job Description" icon={FileText}>
                                    <TextArea name="jobDescription" rows={4} value={formData.jobDescription} onChange={handleChange} placeholder="e.g. Standard crane hire for steel erection..." />
                                </InputGroup>
                            </div>

                            <div className="md:col-span-2">
                                <InputGroup label="Crane Model" icon={Truck}>
                                    <div className="relative">
                                        <select name="craneType" value={formData.craneType} onChange={handleCraneChange} className="w-full bg-transparent outline-none text-slate-800 font-semibold appearance-none text-sm cursor-pointer">
                                            {CRANE_LIST.map((group) => (
                                                <optgroup key={group.category} label={group.category} className="text-yellow-600 bg-white">
                                                    {group.cranes.map((crane) => <option key={crane} value={crane} className="text-slate-800 bg-white">{crane}</option>)}
                                                </optgroup>
                                            ))}
                                        </select>
                                    </div>
                                </InputGroup>
                            </div>

                            <div className="md:col-span-2 bg-slate-50 p-4 rounded-xl border border-slate-200 space-y-4">
                                <div className="text-xs font-bold text-slate-400 uppercase tracking-widest px-1 flex gap-2 items-center"><TruckIcon size={14}/> Hire Package Configuration</div>
                                <div className="grid grid-cols-3 gap-3">
                                    <Stepper label="Mob (Hrs)" value={formData.mobHours} onChange={(v) => updateHours('mobHours', v)} step={0.5} />
                                    <Stepper label="Demob (Hrs)" value={formData.demobHours} onChange={(v) => updateHours('demobHours', v)} step={0.5} />
                                    <Stepper label="Onsite (Hrs)" value={formData.siteHours} onChange={(v) => updateHours('siteHours', v)} step={0.5} />
                                </div>
                                <div className="text-xs text-slate-500 text-center font-mono">Total Hours: <span className="font-bold text-slate-900">{totalMinHours}</span></div>
                                <div className="grid grid-cols-2 gap-4">
                                    <InputGroup label="Normal Rate (€/hr)" icon={Euro}><TextInput type="number" name="hourlyRate" value={formData.hourlyRate} onChange={handleChange} /></InputGroup>
                                    <InputGroup label="Overtime Rate (€/hr)" icon={Clock}><TextInput type="number" name="overtimeRate" value={formData.overtimeRate} onChange={handleChange} /></InputGroup>
                                </div>
                            </div>

                            <div className="md:col-span-2 space-y-4">
                                <div className="text-xs font-bold text-slate-400 uppercase tracking-widest px-1 flex justify-between items-center">
                                    <span>Additional Services</span>
                                    <label className="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" name="addVat" checked={formData.addVat} onChange={handleChange} className="sr-only peer" />
                                        <div className="w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-yellow-300 rounded-full peer peer-checked:bg-yellow-500 after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:after:translate-x-full peer-checked:after:border-white"></div>
                                        <span className="ml-2 text-[10px] font-bold text-slate-500">VAT (23%)</span>
                                    </label>
                                </div>
                                
                                {/* LIFT PLAN */}
                                <div className="bg-slate-50 p-4 rounded-xl border border-slate-200">
                                    <div className="flex flex-col md:flex-row md:items-center gap-4">
                                        <label className="flex items-center gap-2 cursor-pointer min-w-[150px]">
                                            <input type="checkbox" name="liftPlanRequired" checked={formData.liftPlanRequired} onChange={handleChange} className="w-5 h-5 accent-yellow-500 rounded"/>
                                            <span className="text-sm font-bold text-slate-700 flex items-center gap-2"><FileCheck size={16}/> Lift Plan</span>
                                        </label>
                                        {formData.liftPlanRequired && (
                                            <div className="flex-1 flex gap-4 animate-fade-in items-center">
                                                <div className="relative flex-1"><span className="absolute left-3 top-2.5 text-slate-400 text-xs font-bold">€</span><input type="number" name="liftPlanCost" disabled={formData.liftPlanIncluded} value={formData.liftPlanCost} onChange={handleChange} className="w-full bg-white border border-slate-300 rounded-lg py-2 pl-7 pr-3 text-sm outline-none disabled:bg-slate-100"/></div>
                                                <label className="flex items-center gap-2 cursor-pointer whitespace-nowrap"><input type="checkbox" name="liftPlanIncluded" checked={formData.liftPlanIncluded} onChange={handleChange} className="w-4 h-4 accent-green-500 rounded"/><span className="text-xs font-bold text-slate-600">Included</span></label>
                                            </div>
                                        )}
                                    </div>
                                </div>

                                {/* LIFT SUPERVISOR */}
                                <div className="bg-slate-50 p-4 rounded-xl border border-slate-200">
                                    <div className="flex flex-col md:flex-row md:items-center gap-4">
                                        <label className="flex items-center gap-2 cursor-pointer min-w-[150px]">
                                            <input type="checkbox" name="apRequired" checked={formData.apRequired} onChange={handleChange} className="w-5 h-5 accent-yellow-500 rounded"/>
                                            <span className="text-sm font-bold text-slate-700 flex items-center gap-2"><Briefcase size={16}/> Lift Supervisor</span>
                                        </label>
                                        {formData.apRequired && (
                                            <div className="flex-1 flex flex-col md:flex-row gap-4 animate-fade-in md:items-center">
                                                <div className="flex items-center gap-2 w-full md:w-32"><span className="text-xs font-bold text-slate-500 w-8">Qty: {formData.apCount}</span><input type="range" name="apCount" min="1" max="5" value={formData.apCount} onChange={handleChange} className="flex-1"/></div>
                                                <div className="flex gap-4 items-center flex-1">
                                                    <div className="relative flex-1"><span className="absolute left-3 top-2.5 text-slate-400 text-xs font-bold">€</span><input type="number" name="apCost" disabled={formData.apIncluded} value={formData.apCost} onChange={handleChange} className="w-full bg-white border border-slate-300 rounded-lg py-2 pl-7 pr-3 text-sm outline-none disabled:bg-slate-100"/></div>
                                                    <label className="flex items-center gap-2 cursor-pointer whitespace-nowrap"><input type="checkbox" name="apIncluded" checked={formData.apIncluded} onChange={handleChange} className="w-4 h-4 accent-green-500 rounded"/><span className="text-xs font-bold text-slate-600">Included</span></label>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </div>

                                {/* BANKSMAN */}
                                <div className="bg-slate-50 p-4 rounded-xl border border-slate-200">
                                    <div className="flex flex-col md:flex-row md:items-center gap-4">
                                        <label className="flex items-center gap-2 cursor-pointer min-w-[150px]">
                                            <input type="checkbox" name="banksmanRequired" checked={formData.banksmanRequired} onChange={handleChange} className="w-5 h-5 accent-yellow-500 rounded"/>
                                            <span className="text-sm font-bold text-slate-700 flex items-center gap-2"><Users size={16}/> Banksman</span>
                                        </label>
                                        {formData.banksmanRequired && (
                                            <div className="flex-1 flex flex-col md:flex-row gap-4 animate-fade-in md:items-center">
                                                <div className="flex items-center gap-2 w-full md:w-32"><span className="text-xs font-bold text-slate-500 w-8">Qty: {formData.banksmanCount}</span><input type="range" name="banksmanCount" min="1" max="5" value={formData.banksmanCount} onChange={handleChange} className="flex-1"/></div>
                                                <div className="flex gap-4 items-center flex-1">
                                                    <div className="relative flex-1"><span className="absolute left-3 top-2.5 text-slate-400 text-xs font-bold">€</span><input type="number" name="banksmanCost" disabled={formData.banksmanIncluded} value={formData.banksmanCost} onChange={handleChange} className="w-full bg-white border border-slate-300 rounded-lg py-2 pl-7 pr-3 text-sm outline-none disabled:bg-slate-100"/></div>
                                                    <label className="flex items-center gap-2 cursor-pointer whitespace-nowrap"><input type="checkbox" name="banksmanIncluded" checked={formData.banksmanIncluded} onChange={handleChange} className="w-4 h-4 accent-green-500 rounded"/><span className="text-xs font-bold text-slate-600">Included</span></label>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </div>

                                {/* BALLAST TRUCK */}
                                <div className="bg-slate-50 p-4 rounded-xl border border-slate-200">
                                    <div className="flex flex-col md:flex-row md:items-center gap-4">
                                        <label className="flex items-center gap-2 cursor-pointer min-w-[150px]">
                                            <input type="checkbox" name="ballastRequired" checked={formData.ballastRequired} onChange={handleChange} className="w-5 h-5 accent-yellow-500 rounded"/>
                                            <span className="text-sm font-bold text-slate-700 flex items-center gap-2"><TruckIcon size={16}/> Ballast Truck</span>
                                        </label>
                                        {formData.ballastRequired && (
                                            <div className="flex-1 flex gap-4 animate-fade-in items-center">
                                                <div className="relative flex-1">
                                                    <span className="absolute left-3 top-2.5 text-slate-400 text-xs font-bold">€</span>
                                                    <input type="number" name="ballastCost" value={formData.ballastCost} onChange={handleChange} className="w-full bg-white border border-slate-300 rounded-lg py-2 pl-7 pr-3 text-sm outline-none"/>
                                                </div>
                                                <span className="text-xs font-bold text-slate-400 whitespace-nowrap">Each Way</span>
                                            </div>
                                        )}
                                    </div>
                                </div>

                                {/* SPREADER BARS */}
                                <div className="bg-slate-50 p-4 rounded-xl border border-slate-200">
                                    <div className="flex flex-col md:flex-row md:items-center gap-4">
                                        <label className="flex items-center gap-2 cursor-pointer min-w-[150px]">
                                            <input type="checkbox" name="spreaderBars" checked={formData.spreaderBars} onChange={handleChange} className="w-5 h-5 accent-yellow-500 rounded"/>
                                            <span className="text-sm font-bold text-slate-700 flex items-center gap-2"><SpreaderBarIcon size={16}/> Spreader Bars</span>
                                        </label>
                                        {formData.spreaderBars && (
                                            <div className="flex-1 flex gap-4 animate-fade-in items-center">
                                                <div className="relative flex-1">
                                                    <span className="absolute left-3 top-2.5 text-slate-400 text-xs font-bold">€</span>
                                                    <input type="number" name="spreaderCost" value={formData.spreaderCost} onChange={handleChange} className="w-full bg-white border border-slate-300 rounded-lg py-2 pl-7 pr-3 text-sm outline-none"/>
                                                </div>
                                                <span className="text-xs font-bold text-slate-400 whitespace-nowrap">Each Way</span>
                                            </div>
                                        )}
                                    </div>
                                </div>

                                {/* OTHER ITEMS */}
                                <div className="bg-slate-50 p-4 rounded-xl border border-slate-200">
                                    <div className="flex flex-col md:flex-row md:items-center gap-4">
                                        <label className="flex items-center gap-2 cursor-pointer min-w-[150px]">
                                            <input type="checkbox" name="otherItemsRequired" checked={formData.otherItemsRequired} onChange={handleChange} className="w-5 h-5 accent-yellow-500 rounded"/>
                                            <span className="text-sm font-bold text-slate-700 flex items-center gap-2"><Box size={16}/> Other Items</span>
                                        </label>
                                        {formData.otherItemsRequired && (
                                            <div className="flex-1 flex gap-2 animate-fade-in items-center">
                                                <input type="text" name="otherItemsDesc" placeholder="Description" value={formData.otherItemsDesc} onChange={handleChange} className="flex-[2] bg-white border border-slate-300 rounded-lg py-2 px-3 text-sm outline-none"/>
                                                <div className="relative flex-1">
                                                    <span className="absolute left-3 top-2.5 text-slate-400 text-xs font-bold">€</span>
                                                    <input type="number" name="otherItemsCost" placeholder="0.00" value={formData.otherItemsCost} onChange={handleChange} className="w-full bg-white border border-slate-300 rounded-lg py-2 pl-7 pr-3 text-sm outline-none"/>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </div>

                            </div>
                        </div>

                        <div className="flex gap-4 overflow-x-auto py-2">
                             <div className="flex items-center gap-2 px-3 py-1.5 rounded bg-white border border-slate-200 whitespace-nowrap shadow-sm"><ShieldCheck size={12} className="text-brand-yellow" /><span className="text-[10px] font-bold text-slate-500">ISO 9001 Certified</span></div>
                             <div className="flex items-center gap-2 px-3 py-1.5 rounded bg-white border border-slate-200 whitespace-nowrap shadow-sm"><Map size={12} className="text-brand-yellow" /><span className="text-[10px] font-bold text-slate-500">Nationwide Coverage</span></div>
                        </div>
                    </main>

                    <div className="fixed bottom-0 left-0 right-0 p-4 bg-white/90 backdrop-blur-xl border-t border-slate-200 z-50">
                        <div className="max-w-3xl mx-auto flex flex-col gap-2">
                            {statusMsg && <div className="text-center text-[10px] font-bold text-blue-500 animate-pulse">{statusMsg}</div>}
                            <button onClick={handleGenerate} disabled={isGenerating || !formData.clientName} className="w-full bg-kavanagh-blue text-slate-900 font-bold text-sm py-4 rounded-xl shadow-lg hover:bg-[#33d6ff] active:scale-95 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2">
                                {isGenerating ? <span>Generating PDF...</span> : <><Share size={18} /> Generate Quote & Share</>}
                            </button>
                            <div className="text-center text-[10px] text-slate-400 pb-1">Created by Dave Maher © 2026</div>
                        </div>
                    </div>
                </div>
            );
        }
        const root = createRoot(document.getElementById('root'));
        root.render(<ErrorBoundary><AppContent /></ErrorBoundary>);
    </script>
</body>
</html>
